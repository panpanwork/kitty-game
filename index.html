<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kitty Bounce '98</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'MS Sans Serif', 'Microsoft Sans Serif', Arial, sans-serif;
            background: #008080;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }

        .window {
            background: #c0c0c0;
            border: 2px solid;
            border-color: #dfdfdf #808080 #808080 #dfdfdf;
            box-shadow: 2px 2px 0 rgba(0,0,0,0.2);
            max-width: 900px;
            width: 100%;
        }

        .title-bar {
            background: linear-gradient(to right, #000080, #1084d0);
            padding: 3px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .title-text {
            color: white;
            font-weight: bold;
            font-size: 14px;
            padding-left: 5px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .title-icon {
            width: 16px;
            height: 16px;
            image-rendering: pixelated;
        }

        .window-controls {
            display: flex;
            gap: 2px;
        }

        .window-btn {
            width: 18px;
            height: 18px;
            background: #c0c0c0;
            border: 1px solid;
            border-color: #ffffff #000000 #000000 #ffffff;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-weight: bold;
        }

        .window-btn:active {
            border-color: #000000 #ffffff #ffffff #000000;
        }

        .menu-bar {
            background: #c0c0c0;
            border-bottom: 2px solid;
            border-color: #dfdfdf #808080 #808080 #dfdfdf;
            padding: 2px 5px;
            font-size: 13px;
        }

        .menu-item {
            display: inline-block;
            padding: 3px 8px;
            cursor: pointer;
        }

        .menu-item:hover {
            background: #000080;
            color: white;
        }

        .toolbar {
            background: #c0c0c0;
            padding: 5px;
            border-bottom: 2px solid;
            border-color: #dfdfdf #808080 #808080 #dfdfdf;
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .stat-group {
            background: #ffffff;
            border: 2px solid;
            border-color: #808080 #dfdfdf #dfdfdf #808080;
            padding: 4px 8px;
            font-size: 13px;
            display: flex;
            gap: 15px;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .stat-label {
            font-weight: bold;
        }

        .stat-value {
            color: #000080;
            font-weight: bold;
        }

        .content-area {
            background: #c0c0c0;
            padding: 8px;
        }

        .game-frame {
            background: #ffffff;
            border: 2px solid;
            border-color: #808080 #dfdfdf #dfdfdf #808080;
            position: relative;
        }

        canvas {
            display: block;
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }

        .overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #c0c0c0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 2px solid;
            border-color: #dfdfdf #808080 #808080 #dfdfdf;
        }

        .dialog-box {
            background: #c0c0c0;
            border: 2px solid;
            border-color: #dfdfdf #808080 #808080 #dfdfdf;
            padding: 15px;
            min-width: 400px;
        }

        .dialog-title {
            background: linear-gradient(to right, #000080, #1084d0);
            color: white;
            padding: 3px 5px;
            font-weight: bold;
            font-size: 14px;
            margin: -15px -15px 10px -15px;
        }

        .dialog-content {
            padding: 15px;
            background: #ffffff;
            border: 2px solid;
            border-color: #808080 #dfdfdf #dfdfdf #808080;
            margin-bottom: 15px;
        }

        .dialog-content h2 {
            color: #000080;
            margin-bottom: 10px;
            font-size: 18px;
        }

        .legend {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 10px 0;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 5px;
            background: #f0f0f0;
            border: 1px solid #808080;
        }

        .kitty-preview {
            width: 32px;
            height: 32px;
            image-rendering: pixelated;
        }

        .legend-text {
            font-size: 12px;
        }

        .win98-btn {
            background: #c0c0c0;
            border: 2px solid;
            border-color: #ffffff #000000 #000000 #ffffff;
            padding: 8px 20px;
            font-family: inherit;
            font-size: 13px;
            cursor: pointer;
            font-weight: bold;
            min-width: 80px;
        }

        .win98-btn:hover {
            background: #d4d4d4;
        }

        .win98-btn:active {
            border-color: #000000 #ffffff #ffffff #000000;
            padding: 9px 19px 7px 21px;
        }

        .status-bar {
            background: #c0c0c0;
            border-top: 2px solid;
            border-color: #dfdfdf #808080 #808080 #dfdfdf;
            padding: 3px 5px;
            font-size: 12px;
            display: flex;
            gap: 10px;
        }

        .status-section {
            border: 2px solid;
            border-color: #808080 #dfdfdf #dfdfdf #808080;
            padding: 2px 8px;
        }

        .game-over-screen {
            display: none;
        }

        .collectible-info {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin: 10px 0;
        }

        .collectible-badge {
            background: #f0f0f0;
            border: 1px solid #808080;
            padding: 5px 8px;
            font-size: 11px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .win98-input {
            background: #ffffff;
            border: 2px solid;
            border-color: #808080 #dfdfdf #dfdfdf #808080;
            padding: 4px 8px;
            font-family: inherit;
            font-size: 13px;
            width: 100%;
        }

        .paddle-option {
            background: #f0f0f0;
            border: 3px solid #808080;
            padding: 15px;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
        }

        .paddle-option:hover {
            background: #e0e0e0;
        }

        .paddle-option.selected {
            border-color: #000080;
            background: #d4d4ff;
        }

        .paddle-preview {
            font-size: 48px;
            margin-bottom: 10px;
        }

        @media (max-width: 900px) {
            .dialog-box {
                min-width: auto;
                max-width: 90vw;
            }

            .legend {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="window">
        <div class="title-bar">
            <div class="title-text">
                <span>üê±</span>
                <span>Kitty Bounce '98</span>
            </div>
            <div class="window-controls">
                <div class="window-btn">_</div>
                <div class="window-btn">‚ñ°</div>
                <div class="window-btn" onclick="if(confirm('Are you sure you want to quit?')) window.close()">√ó</div>
            </div>
        </div>

        <div class="menu-bar">
            <span class="menu-item">File</span>
            <span class="menu-item">Game</span>
            <span class="menu-item">Options</span>
            <span class="menu-item">Help</span>
        </div>

        <div class="toolbar">
            <div class="stat-group">
                <div class="stat-item">
                    <span class="stat-label">Score:</span>
                    <span class="stat-value" id="score">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Lives:</span>
                    <span class="stat-value" id="lives">3</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">High Score:</span>
                    <span class="stat-value" id="highScore">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Level:</span>
                    <span class="stat-value" id="level">1</span>
                </div>
            </div>
        </div>

        <div class="content-area">
            <div class="game-frame">
                <canvas id="gameCanvas" width="800" height="600"></canvas>

                <div class="overlay" id="startScreen">
                    <div class="dialog-box">
                        <div class="dialog-title">Kitty Bounce '98 - New Game</div>
                        <div class="dialog-content">
                            <h2>Welcome to Kitty Bounce!</h2>
                            <p><strong>Controls:</strong> Use Mouse or Arrow Keys (‚Üê ‚Üí)</p>
                            <p style="margin-top: 10px;"><strong>Objective:</strong> Bounce kitties and collect items!</p>

                            <div style="margin-top: 15px;">
                                <strong>Meet the Kitties:</strong>
                                <div class="legend">
                                    <div class="legend-item">
                                        <canvas class="kitty-preview" id="preview1" width="32" height="32"></canvas>
                                        <div class="legend-text">
                                            <strong>Orange Tabby</strong><br>
                                            <small>10 pts ‚Ä¢ Common</small>
                                        </div>
                                    </div>
                                    <div class="legend-item">
                                        <canvas class="kitty-preview" id="preview2" width="32" height="32"></canvas>
                                        <div class="legend-text">
                                            <strong>Black Cat</strong><br>
                                            <small>20 pts ‚Ä¢ Uncommon</small>
                                        </div>
                                    </div>
                                    <div class="legend-item">
                                        <canvas class="kitty-preview" id="preview3" width="32" height="32"></canvas>
                                        <div class="legend-text">
                                            <strong>White Cat</strong><br>
                                            <small>30 pts ‚Ä¢ Rare</small>
                                        </div>
                                    </div>
                                    <div class="legend-item">
                                        <canvas class="kitty-preview" id="preview4" width="32" height="32"></canvas>
                                        <div class="legend-text">
                                            <strong>Calico</strong><br>
                                            <small>50 pts ‚Ä¢ Very Rare</small>
                                        </div>
                                    </div>
                                    <div class="legend-item">
                                        <canvas class="kitty-preview" id="preview5" width="32" height="32"></canvas>
                                        <div class="legend-text">
                                            <strong>Golden Cat</strong><br>
                                            <small>100 pts ‚Ä¢ Legendary!</small>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div style="margin-top: 15px;">
                                <strong>Collectibles:</strong>
                                <div class="collectible-info">
                                    <div class="collectible-badge">üêü Fish +5</div>
                                    <div class="collectible-badge">üß∂ Yarn +10</div>
                                    <div class="collectible-badge">üíù Heart +15</div>
                                    <div class="collectible-badge">‚≠ê Star +25</div>
                                </div>
                            </div>

                            <div style="margin-top: 15px;">
                                <strong>Enter Your Name:</strong>
                                <input type="text" id="playerName" class="win98-input"
                                       placeholder="Player" maxlength="20"
                                       style="margin-top: 5px;">
                            </div>
                        </div>
                        <center>
                            <button class="win98-btn" onclick="startGame()">Start Game</button>
                        </center>
                    </div>
                </div>

                <div class="overlay" id="paddleSelectScreen" style="display: none;">
                    <div class="dialog-box">
                        <div class="dialog-title">Choose Your Cat Toy</div>
                        <div class="dialog-content">
                            <h2>Select Your Paddle Design</h2>
                            <div id="paddleOptions" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin: 15px 0;">
                            </div>
                        </div>
                        <center>
                            <button class="win98-btn" onclick="confirmPaddleSelection()">Continue</button>
                        </center>
                    </div>
                </div>

                <div class="overlay game-over-screen" id="gameOverScreen">
                    <div class="dialog-box">
                        <div class="dialog-title">Game Over</div>
                        <div class="dialog-content">
                            <h2 id="gameOverTitle">Game Over!</h2>
                            <p id="highScoreMessage" style="color: #FF8C00; font-weight: bold; display: none; margin-bottom: 10px;">
                                üéâ NEW HIGH SCORE! üéâ
                            </p>
                            <p style="font-size: 16px; margin: 15px 0;">
                                <strong>Final Score:</strong> <span id="finalScore" style="color: #000080; font-size: 24px;">0</span>
                            </p>
                            <p>
                                <strong>Level Reached:</strong> <span id="finalLevel">1</span>
                            </p>
                        </div>
                        <center style="display: flex; gap: 10px; justify-content: center;">
                            <button class="win98-btn" onclick="returnToHome()">Return to Home</button>
                            <button class="win98-btn" onclick="restartGame()">Play Again</button>
                        </center>
                    </div>
                </div>
            </div>
        </div>

        <div class="status-bar">
            <div class="status-section">Ready</div>
            <div class="status-section" id="statusMessage">Press Start to begin</div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        ctx.imageSmoothingEnabled = false;

        // Game state
        let gameRunning = false;
        let animationId = null;
        let score = 0;
        let lives = 3;
        let level = 1;
        let highScore = localStorage.getItem('kittyBounce98HighScore') || 0;
        document.getElementById('highScore').textContent = highScore;

        // Define kitty types with pixel art
        const kittyTypes = [
            { name: 'Orange Tabby', color: '#FF8C00', stripes: '#D2691E', points: 10, weight: 40, speed: 1 },
            { name: 'Black Cat', color: '#1a1a1a', stripes: '#000000', points: 20, weight: 30, speed: 1.2 },
            { name: 'White Cat', color: '#FFFFFF', stripes: '#F0F0F0', points: 30, weight: 15, speed: 1.4 },
            { name: 'Calico', color: '#FF6B35', stripes: '#1a1a1a', points: 50, weight: 10, speed: 1.6 },
            { name: 'Golden Cat', color: '#FFD700', stripes: '#FFA500', points: 100, weight: 5, speed: 2 }
        ];

        // Paddle
        const paddle = {
            x: canvas.width / 2 - 60,
            y: canvas.height - 30,
            width: 120,
            height: 15,
            speed: 8,
            dx: 0
        };

        // Paddle designs
        const paddleDesigns = [
            {
                name: 'Cat Toy Stick',
                id: 'toy_stick',
                preview: 'üé£',
                description: 'Classic feather toy'
            },
            {
                name: 'Cushion',
                id: 'cushion',
                preview: 'üõèÔ∏è',
                description: 'Soft and comfy'
            },
            {
                name: 'Mouse Toy',
                id: 'mouse',
                preview: 'üê≠',
                description: 'Squeaky mouse'
            },
            {
                name: 'Laser Pointer',
                id: 'laser',
                preview: 'üî¥',
                description: 'Mesmerizing red dot'
            }
        ];

        let selectedPaddle = paddleDesigns[0];

        // Kitties (multiple!)
        let kitties = [];

        // Collectibles
        let collectibles = [];
        const collectibleTypes = [
            { icon: 'üêü', points: 5, weight: 40 },
            { icon: 'üß∂', points: 10, weight: 30 },
            { icon: 'üíù', points: 15, weight: 20 },
            { icon: '‚≠ê', points: 25, weight: 10 }
        ];

        let lastCollectibleTime = 0;
        const collectibleInterval = 2500;

        // Input
        let keys = {};
        let mouseX = canvas.width / 2;

        document.addEventListener('keydown', (e) => {
            keys[e.key] = true;
        });

        document.addEventListener('keyup', (e) => {
            keys[e.key] = false;
        });

        canvas.addEventListener('mousemove', (e) => {
            const rect = canvas.getBoundingClientRect();
            mouseX = e.clientX - rect.left;
        });

        // Draw pixel art kitty
        function drawPixelKitty(ctx, x, y, size, type) {
            const pixelSize = size / 16;

            // Kitty pixel pattern (16x16)
            const pattern = [
                [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                [0,0,1,1,0,0,0,0,0,0,0,0,1,1,0,0],
                [0,1,2,2,1,0,0,0,0,0,0,1,2,2,1,0],
                [0,1,2,2,2,1,1,1,1,1,1,2,2,2,1,0],
                [0,0,1,2,2,2,2,2,2,2,2,2,2,1,0,0],
                [0,0,0,1,2,2,2,2,2,2,2,2,1,0,0,0],
                [0,0,1,2,2,3,3,2,2,3,3,2,2,1,0,0],
                [0,0,1,2,2,3,3,2,2,3,3,2,2,1,0,0],
                [0,0,1,2,2,2,2,2,2,2,2,2,2,1,0,0],
                [0,0,1,2,2,2,4,4,4,4,2,2,2,1,0,0],
                [0,0,1,2,2,4,2,2,2,2,4,2,2,1,0,0],
                [0,0,1,2,2,2,4,4,4,4,2,2,2,1,0,0],
                [0,0,0,1,2,2,2,2,2,2,2,2,1,0,0,0],
                [0,0,0,0,1,1,2,2,2,2,1,1,0,0,0,0],
                [0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0],
                [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
            ];

            const colors = {
                0: 'transparent',
                1: '#000000',        // outline
                2: type.color,       // main color
                3: '#000000',        // eyes
                4: '#FF69B4'         // nose/mouth
            };

            // Add stripes for tabby patterns
            if (type.name === 'Orange Tabby' || type.name === 'Calico') {
                for (let row = 0; row < 16; row++) {
                    for (let col = 0; col < 16; col++) {
                        if (pattern[row][col] === 2 && (row % 3 === 0 || col % 4 === 0)) {
                            ctx.fillStyle = type.stripes;
                            ctx.fillRect(x - size/2 + col * pixelSize, y - size/2 + row * pixelSize, pixelSize, pixelSize);
                        }
                    }
                }
            }

            // Draw main pattern
            for (let row = 0; row < 16; row++) {
                for (let col = 0; col < 16; col++) {
                    const colorKey = pattern[row][col];
                    if (colorKey !== 0) {
                        ctx.fillStyle = colors[colorKey];
                        ctx.fillRect(x - size/2 + col * pixelSize, y - size/2 + row * pixelSize, pixelSize, pixelSize);
                    }
                }
            }
        }

        // Initialize preview kitties
        function initPreviews() {
            kittyTypes.forEach((type, index) => {
                const previewCanvas = document.getElementById(`preview${index + 1}`);
                if (previewCanvas) {
                    const previewCtx = previewCanvas.getContext('2d');
                    previewCtx.imageSmoothingEnabled = false;
                    drawPixelKitty(previewCtx, 16, 16, 24, type);
                }
            });
        }

        initPreviews();

        function spawnKitty() {
            const totalWeight = kittyTypes.reduce((sum, type) => sum + type.weight, 0);
            let random = Math.random() * totalWeight;

            let selectedType = kittyTypes[0];
            for (let type of kittyTypes) {
                random -= type.weight;
                if (random <= 0) {
                    selectedType = type;
                    break;
                }
            }

            const kitty = {
                x: Math.random() * (canvas.width - 60) + 30,
                y: 100,
                radius: 20,
                dx: (Math.random() - 0.5) * 6,
                dy: 3 + Math.random() * 2,
                type: selectedType,
                rotation: 0
            };

            kitties.push(kitty);
            updateStatus(`${selectedType.name} appeared! Worth ${selectedType.points} pts`);
        }

        function spawnCollectible() {
            const totalWeight = collectibleTypes.reduce((sum, type) => sum + type.weight, 0);
            let random = Math.random() * totalWeight;

            let selectedType = collectibleTypes[0];
            for (let type of collectibleTypes) {
                random -= type.weight;
                if (random <= 0) {
                    selectedType = type;
                    break;
                }
            }

            collectibles.push({
                x: Math.random() * (canvas.width - 40) + 20,
                y: -30,
                size: 20,
                type: selectedType,
                dy: 2 + Math.random() * 2
            });
        }

        function startGame() {
            const playerName = document.getElementById('playerName').value.trim() || 'Player';
            localStorage.setItem('kittyBounce98PlayerName', playerName);

            document.getElementById('startScreen').style.display = 'none';
            showPaddleSelection();
        }

        function showPaddleSelection() {
            const screen = document.getElementById('paddleSelectScreen');
            const optionsContainer = document.getElementById('paddleOptions');

            optionsContainer.innerHTML = '';
            paddleDesigns.forEach((design, index) => {
                const option = document.createElement('div');
                option.className = 'paddle-option';
                if (index === 0) option.classList.add('selected');
                option.innerHTML = `
                    <div class="paddle-preview">${design.preview}</div>
                    <strong>${design.name}</strong><br>
                    <small>${design.description}</small>
                `;
                option.onclick = () => selectPaddle(index, option);
                optionsContainer.appendChild(option);
            });

            screen.style.display = 'flex';
        }

        function selectPaddle(index, element) {
            document.querySelectorAll('.paddle-option').forEach(opt => {
                opt.classList.remove('selected');
            });

            element.classList.add('selected');
            selectedPaddle = paddleDesigns[index];
        }

        function confirmPaddleSelection() {
            document.getElementById('paddleSelectScreen').style.display = 'none';
            gameRunning = true;
            lastCollectibleTime = Date.now();
            resetGame();
            spawnKitty();
            gameLoop();
            updateStatus(`Game started with ${selectedPaddle.name}!`);
        }

        function restartGame() {
            console.log('Restarting game...');

            // Stop any running game and cancel animations
            gameRunning = false;
            if (animationId) {
                cancelAnimationFrame(animationId);
                animationId = null;
            }

            // Hide game over screen
            document.getElementById('gameOverScreen').style.display = 'none';

            // Reset all game state
            score = 0;
            lives = 3;
            level = 1;
            kitties = [];
            collectibles = [];
            lastCollectibleTime = Date.now();

            // Update UI
            updateScore();
            updateLives();
            updateLevel();

            // Reset paddle position
            resetGame();

            // Clear canvas and draw background
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawBackground();
            drawPaddle();

            // Spawn first kitty
            spawnKitty();
            console.log('Kitty spawned:', kitties.length);

            // Start game
            gameRunning = true;
            updateStatus('Game restarted! Good luck!');

            // Start game loop immediately
            animationId = requestAnimationFrame(gameLoop);
            console.log('Game loop started');
        }

        function resetGame() {
            paddle.x = canvas.width / 2 - paddle.width / 2;
        }

        function returnToHome() {
            gameRunning = false;
            if (animationId) {
                cancelAnimationFrame(animationId);
                animationId = null;
            }

            document.getElementById('gameOverScreen').style.display = 'none';
            document.getElementById('highScoreMessage').style.display = 'none';
            document.getElementById('startScreen').style.display = 'flex';

            score = 0;
            lives = 3;
            level = 1;
            kitties = [];
            collectibles = [];

            updateScore();
            updateLives();
            updateLevel();

            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawBackground();

            updateStatus('Ready to play again!');
        }

        function updatePaddle() {
            if (keys['ArrowLeft'] && paddle.x > 0) {
                paddle.x -= paddle.speed;
            }
            if (keys['ArrowRight'] && paddle.x + paddle.width < canvas.width) {
                paddle.x += paddle.speed;
            }

            const targetX = mouseX - paddle.width / 2;
            const diff = targetX - paddle.x;
            paddle.x += diff * 0.2;

            if (paddle.x < 0) paddle.x = 0;
            if (paddle.x + paddle.width > canvas.width) paddle.x = canvas.width - paddle.width;
        }

        function updateKitties() {
            for (let i = kitties.length - 1; i >= 0; i--) {
                const kitty = kitties[i];

                kitty.x += kitty.dx * kitty.type.speed;
                kitty.y += kitty.dy * kitty.type.speed;
                kitty.rotation += 0.05;

                // Wall collision
                if (kitty.x + kitty.radius > canvas.width || kitty.x - kitty.radius < 0) {
                    kitty.dx *= -1;
                }

                // Top collision
                if (kitty.y - kitty.radius < 0) {
                    kitty.dy *= -1;
                }

                // Paddle collision
                if (
                    kitty.y + kitty.radius > paddle.y &&
                    kitty.y + kitty.radius < paddle.y + paddle.height &&
                    kitty.x > paddle.x &&
                    kitty.x < paddle.x + paddle.width
                ) {
                    kitty.dy = -Math.abs(kitty.dy);
                    const hitPos = (kitty.x - paddle.x) / paddle.width;
                    kitty.dx = (hitPos - 0.5) * 8;

                    score += kitty.type.points;
                    updateScore();
                    updateStatus(`Bounced ${kitty.type.name}! +${kitty.type.points} pts`);
                }

                // Bottom boundary
                if (kitty.y - kitty.radius > canvas.height) {
                    kitties.splice(i, 1);
                    lives--;
                    updateLives();
                    updateStatus(`Lost a ${kitty.type.name}! -1 life`);

                    if (lives <= 0) {
                        gameOver();
                    } else if (kitties.length === 0) {
                        setTimeout(() => spawnKitty(), 500);
                    }
                }
            }

            // Spawn new kitty occasionally
            if (kitties.length < level && Math.random() < 0.003) {
                spawnKitty();
            }
        }

        function updateCollectibles() {
            const currentTime = Date.now();
            if (currentTime - lastCollectibleTime > collectibleInterval) {
                spawnCollectible();
                lastCollectibleTime = currentTime;
            }

            for (let i = collectibles.length - 1; i >= 0; i--) {
                const c = collectibles[i];
                c.y += c.dy;

                // Check collision with any kitty
                for (let kitty of kitties) {
                    const dist = Math.hypot(kitty.x - c.x, kitty.y - c.y);
                    if (dist < kitty.radius + c.size / 2) {
                        score += c.type.points;
                        updateScore();
                        updateStatus(`Collected ${c.type.icon}! +${c.type.points} pts`);
                        collectibles.splice(i, 1);
                        break;
                    }
                }

                if (c.y > canvas.height + 50) {
                    collectibles.splice(i, 1);
                }
            }
        }

        function drawPaddle() {
            switch(selectedPaddle.id) {
                case 'toy_stick':
                    drawToyStickPaddle();
                    break;
                case 'cushion':
                    drawCushionPaddle();
                    break;
                case 'mouse':
                    drawMousePaddle();
                    break;
                case 'laser':
                    drawLaserPaddle();
                    break;
                default:
                    drawToyStickPaddle();
            }
        }

        function drawToyStickPaddle() {
            const centerX = paddle.x + paddle.width / 2;

            ctx.strokeStyle = '#8B4513';
            ctx.lineWidth = 4;
            ctx.beginPath();
            ctx.moveTo(centerX, paddle.y - 20);
            ctx.lineTo(centerX, paddle.y + paddle.height);
            ctx.stroke();

            ctx.strokeStyle = '#D3D3D3';
            ctx.lineWidth = 1;
            ctx.setLineDash([3, 3]);
            ctx.beginPath();
            ctx.moveTo(centerX, paddle.y - 20);
            ctx.lineTo(paddle.x + 10, paddle.y);
            ctx.lineTo(paddle.x + paddle.width - 10, paddle.y);
            ctx.stroke();
            ctx.setLineDash([]);

            ctx.fillStyle = '#FF69B4';
            ctx.fillRect(paddle.x, paddle.y, paddle.width, paddle.height);

            drawFeather(paddle.x + 20, paddle.y + 2, '#FF1493');
            drawFeather(paddle.x + paddle.width / 2, paddle.y + 2, '#FFD700');
            drawFeather(paddle.x + paddle.width - 20, paddle.y + 2, '#00CED1');

            ctx.fillStyle = '#654321';
            ctx.fillRect(centerX - 5, paddle.y - 35, 10, 15);
        }

        function drawFeather(x, y, color) {
            ctx.fillStyle = color;
            ctx.beginPath();
            ctx.moveTo(x, y);
            ctx.quadraticCurveTo(x - 3, y + 5, x - 2, y + 10);
            ctx.quadraticCurveTo(x, y + 8, x + 2, y + 10);
            ctx.quadraticCurveTo(x + 3, y + 5, x, y);
            ctx.fill();
        }

        function drawCushionPaddle() {
            ctx.fillStyle = '#FFB6C1';
            ctx.fillRect(paddle.x, paddle.y, paddle.width, paddle.height);

            ctx.fillStyle = '#FFC0CB';
            ctx.fillRect(paddle.x + 5, paddle.y + 3, paddle.width - 10, paddle.height - 6);

            ctx.strokeStyle = '#FF69B4';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(paddle.x + 20, paddle.y + 2);
            ctx.lineTo(paddle.x + paddle.width - 20, paddle.y + paddle.height - 2);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(paddle.x + paddle.width - 20, paddle.y + 2);
            ctx.lineTo(paddle.x + 20, paddle.y + paddle.height - 2);
            ctx.stroke();
        }

        function drawMousePaddle() {
            ctx.fillStyle = '#808080';
            ctx.fillRect(paddle.x, paddle.y, paddle.width, paddle.height);

            ctx.fillStyle = '#A9A9A9';
            ctx.beginPath();
            ctx.arc(paddle.x + 30, paddle.y, 8, 0, Math.PI * 2);
            ctx.fill();
            ctx.beginPath();
            ctx.arc(paddle.x + paddle.width - 30, paddle.y, 8, 0, Math.PI * 2);
            ctx.fill();

            ctx.fillStyle = '#FFC0CB';
            ctx.beginPath();
            ctx.arc(paddle.x + paddle.width / 2, paddle.y + paddle.height / 2, 3, 0, Math.PI * 2);
            ctx.fill();

            ctx.strokeStyle = '#696969';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(paddle.x + paddle.width, paddle.y + paddle.height / 2);
            ctx.lineTo(paddle.x + paddle.width + 15, paddle.y + paddle.height / 2);
            ctx.stroke();
        }

        function drawLaserPaddle() {
            ctx.fillStyle = '#C0C0C0';
            ctx.fillRect(paddle.x, paddle.y, paddle.width, paddle.height);

            ctx.fillStyle = '#FF0000';
            ctx.shadowBlur = 10;
            ctx.shadowColor = '#FF0000';
            ctx.beginPath();
            ctx.arc(paddle.x + paddle.width / 2, paddle.y + paddle.height / 2, 5, 0, Math.PI * 2);
            ctx.fill();
            ctx.shadowBlur = 0;

            ctx.strokeStyle = '#A0A0A0';
            ctx.lineWidth = 2;
            ctx.setLineDash([2, 2]);
            for (let i = 0; i < 3; i++) {
                ctx.beginPath();
                ctx.moveTo(paddle.x + 20 + i * 30, paddle.y);
                ctx.lineTo(paddle.x + 20 + i * 30, paddle.y + paddle.height);
                ctx.stroke();
            }
            ctx.setLineDash([]);
        }

        function drawKitties() {
            kitties.forEach(kitty => {
                ctx.save();
                ctx.translate(kitty.x, kitty.y);
                ctx.rotate(kitty.rotation);
                ctx.translate(-kitty.x, -kitty.y);
                drawPixelKitty(ctx, kitty.x, kitty.y, kitty.radius * 2, kitty.type);
                ctx.restore();
            });
        }

        function drawCollectibles() {
            ctx.font = '20px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';

            collectibles.forEach(c => {
                ctx.fillText(c.type.icon, c.x, c.y);
            });
        }

        function drawBackground() {
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, '#B5E3FF');
            gradient.addColorStop(1, '#E8F4FF');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            ctx.fillStyle = '#90EE90';
            ctx.fillRect(0, canvas.height - 80, canvas.width, 80);

            ctx.globalAlpha = 0.3;

            drawTree(100, canvas.height - 80);
            drawTree(300, canvas.height - 80);
            drawTree(500, canvas.height - 80);
            drawTree(700, canvas.height - 80);

            drawBush(150, canvas.height - 50);
            drawBush(450, canvas.height - 50);
            drawBush(650, canvas.height - 50);

            drawForestAnimal('üêøÔ∏è', 50, canvas.height - 60);
            drawForestAnimal('ü¶î', 600, canvas.height - 55);
            drawForestAnimal('üê¶', 250, canvas.height - 120);

            for (let i = 0; i < 10; i++) {
                const x = 80 + i * 70;
                const y = canvas.height - 40;
                ctx.fillStyle = ['#FF69B4', '#FFD700', '#FF6B6B'][i % 3];
                ctx.beginPath();
                ctx.arc(x, y, 3, 0, Math.PI * 2);
                ctx.fill();
            }

            ctx.globalAlpha = 1.0;
        }

        function drawTree(x, y) {
            ctx.fillStyle = '#8B4513';
            ctx.fillRect(x - 8, y - 40, 16, 40);

            ctx.fillStyle = '#228B22';
            ctx.beginPath();
            ctx.moveTo(x, y - 70);
            ctx.lineTo(x - 25, y - 30);
            ctx.lineTo(x + 25, y - 30);
            ctx.closePath();
            ctx.fill();
        }

        function drawBush(x, y) {
            ctx.fillStyle = '#32CD32';
            ctx.beginPath();
            ctx.ellipse(x, y, 20, 12, 0, 0, Math.PI * 2);
            ctx.fill();
        }

        function drawForestAnimal(emoji, x, y) {
            ctx.font = '16px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(emoji, x, y);
        }

        function updateScore() {
            document.getElementById('score').textContent = score;
            if (score > highScore) {
                highScore = score;
                localStorage.setItem('kittyBounce98HighScore', highScore);
                document.getElementById('highScore').textContent = highScore;
            }

            // Level up every 200 points
            const newLevel = Math.floor(score / 200) + 1;
            if (newLevel > level) {
                level = newLevel;
                updateLevel();
                updateStatus(`Level Up! Now at Level ${level}`);
            }
        }

        function updateLives() {
            document.getElementById('lives').textContent = lives;
        }

        function updateLevel() {
            document.getElementById('level').textContent = level;
        }

        function updateStatus(message) {
            document.getElementById('statusMessage').textContent = message;
        }

        function gameOver() {
            gameRunning = false;
            const previousHighScore = parseInt(localStorage.getItem('kittyBounce98HighScore') || 0);
            const isNewHighScore = score > previousHighScore;

            document.getElementById('finalScore').textContent = score;
            document.getElementById('finalLevel').textContent = level;
            document.getElementById('gameOverScreen').style.display = 'flex';
            updateStatus('Game Over');

            if (isNewHighScore) {
                document.getElementById('highScoreMessage').style.display = 'block';
                triggerKittyConfetti();
            } else {
                document.getElementById('highScoreMessage').style.display = 'none';
            }
        }

        function triggerKittyConfetti() {
            const confettiParticles = [];
            const confettiCount = 50;

            for (let i = 0; i < confettiCount; i++) {
                confettiParticles.push({
                    x: canvas.width / 2,
                    y: canvas.height / 2,
                    vx: (Math.random() - 0.5) * 10,
                    vy: (Math.random() - 0.5) * 10 - 5,
                    rotation: Math.random() * Math.PI * 2,
                    rotationSpeed: (Math.random() - 0.5) * 0.2,
                    kittyType: kittyTypes[Math.floor(Math.random() * kittyTypes.length)],
                    size: 15 + Math.random() * 15,
                    life: 0
                });
            }

            function animateConfetti() {
                const overlay = document.getElementById('gameOverScreen');
                if (overlay.style.display !== 'flex') return;

                ctx.clearRect(0, 0, canvas.width, canvas.height);
                drawBackground();

                confettiParticles.forEach((p) => {
                    p.x += p.vx;
                    p.y += p.vy;
                    p.vy += 0.3;
                    p.rotation += p.rotationSpeed;
                    p.life++;

                    if (p.life < 180) {
                        ctx.save();
                        ctx.globalAlpha = 1 - (p.life / 180);
                        ctx.translate(p.x, p.y);
                        ctx.rotate(p.rotation);
                        ctx.translate(-p.x, -p.y);
                        drawPixelKitty(ctx, p.x, p.y, p.size, p.kittyType);
                        ctx.restore();
                    }
                });

                if (confettiParticles.some(p => p.life < 180)) {
                    requestAnimationFrame(animateConfetti);
                }
            }

            animateConfetti();
        }

        function gameLoop() {
            if (!gameRunning) {
                if (animationId) {
                    cancelAnimationFrame(animationId);
                    animationId = null;
                }
                return;
            }

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            drawBackground();
            updatePaddle();
            updateKitties();
            updateCollectibles();

            drawCollectibles();
            drawKitties();
            drawPaddle();

            animationId = requestAnimationFrame(gameLoop);
        }
    </script>
</body>
</html>
