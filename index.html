<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kitty Bounce '98</title>
    <style>
        :root {
            --theme-primary: #000080;
            --theme-secondary: #008080;
            --theme-accent: #c0c0c0;
            --theme-text: #000000;
            --theme-bg: #c0c0c0;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'MS Sans Serif', 'Microsoft Sans Serif', Arial, sans-serif;
            background: var(--theme-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
            transition: background 0.5s ease;
        }

        /* Retro theme (default/pixel art) */
        body.theme-retro {
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }

        /* Frutiger Aero theme */
        body.theme-aero {
            background: linear-gradient(135deg, #B5E3FF 0%, #7FBA00 100%);
            image-rendering: auto;
        }

        body.theme-aero .window {
            background: rgba(240, 248, 255, 0.85);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px rgba(0, 120, 215, 0.3);
        }

        body.theme-aero .title-bar {
            background: linear-gradient(180deg, rgba(0, 120, 215, 0.9) 0%, rgba(0, 188, 242, 0.9) 100%);
            border-radius: 12px 12px 0 0;
            box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        body.theme-aero .win98-btn {
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.9) 0%, rgba(0, 120, 215, 0.7) 100%);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 2px 8px rgba(0, 120, 215, 0.3);
            color: #000;
        }

        body.theme-aero .win98-btn:hover {
            background: linear-gradient(180deg, rgba(255, 255, 255, 1) 0%, rgba(0, 120, 215, 0.8) 100%);
            box-shadow: 0 4px 12px rgba(0, 120, 215, 0.4);
        }

        body.theme-aero .menu-bar,
        body.theme-aero .toolbar,
        body.theme-aero .status-bar,
        body.theme-aero .content-area {
            background: rgba(255, 255, 255, 0.6);
            border: none;
        }

        body.theme-aero .stat-group {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 6px;
            border: 1px solid rgba(0, 120, 215, 0.2);
        }

        /* Y2K Edgy theme */
        body.theme-y2k {
            background: linear-gradient(135deg, #000000 0%, #1a0033 50%, #000000 100%);
            image-rendering: auto;
        }

        body.theme-y2k .window {
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
            border: 2px solid;
            border-image: linear-gradient(45deg, #FF1493, #00FFFF, #FF1493) 1;
            box-shadow: 0 0 30px rgba(255, 20, 147, 0.5), 0 0 60px rgba(0, 255, 255, 0.3);
            clip-path: polygon(
                0 8px, 8px 0, calc(100% - 8px) 0, 100% 8px,
                100% calc(100% - 8px), calc(100% - 8px) 100%, 8px 100%, 0 calc(100% - 8px)
            );
        }

        body.theme-y2k .title-bar {
            background: linear-gradient(90deg,
                #FF1493 0%, #00FFFF 25%, #FF1493 50%, #00FFFF 75%, #FF1493 100%);
            background-size: 200% 100%;
            animation: y2k-shimmer 3s linear infinite;
            box-shadow: inset 0 -2px 0 rgba(0, 0, 0, 0.5);
        }

        @keyframes y2k-shimmer {
            0% { background-position: 0% 50%; }
            100% { background-position: 200% 50%; }
        }

        body.theme-y2k .win98-btn {
            background: linear-gradient(145deg, #C0C0C0 0%, #808080 50%, #C0C0C0 100%);
            border: 2px solid #00FFFF;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.5), inset 0 1px 0 rgba(255, 255, 255, 0.3);
            color: #00FFFF;
            text-shadow: 0 0 5px rgba(0, 255, 255, 0.8);
            clip-path: polygon(
                4px 0, calc(100% - 4px) 0, 100% 4px, 100% calc(100% - 4px),
                calc(100% - 4px) 100%, 4px 100%, 0 calc(100% - 4px), 0 4px
            );
        }

        body.theme-y2k .win98-btn:hover {
            background: linear-gradient(145deg, #E0E0E0 0%, #A0A0A0 50%, #E0E0E0 100%);
            box-shadow: 0 0 20px rgba(255, 20, 147, 0.7), inset 0 1px 0 rgba(255, 255, 255, 0.5);
            border-color: #FF1493;
            color: #FF1493;
            text-shadow: 0 0 8px rgba(255, 20, 147, 0.8);
        }

        body.theme-y2k .menu-bar,
        body.theme-y2k .toolbar,
        body.theme-y2k .status-bar,
        body.theme-y2k .content-area {
            background: rgba(0, 0, 0, 0.8);
            border-color: #00FFFF;
        }

        body.theme-y2k .stat-group {
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid #FF1493;
            box-shadow: 0 0 10px rgba(255, 20, 147, 0.3);
        }

        body.theme-y2k .stat-value,
        body.theme-y2k .stat-label {
            color: #00FFFF;
            text-shadow: 0 0 5px rgba(0, 255, 255, 0.5);
        }

        .window {
            background: #c0c0c0;
            border: 2px solid;
            border-color: #dfdfdf #808080 #808080 #dfdfdf;
            box-shadow: 2px 2px 0 rgba(0,0,0,0.2);
            max-width: 900px;
            width: 100%;
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .window.minimized {
            max-height: 40px;
        }

        .window.minimized .menu-bar,
        .window.minimized .toolbar,
        .window.minimized .content-area,
        .window.minimized .status-bar {
            display: none;
        }

        .window.maximized {
            max-width: 100%;
            width: 100vw;
            height: 100vh;
            margin: 0;
        }

        .window.maximized canvas {
            width: 100%;
            height: calc(100vh - 160px);
        }

        .title-bar {
            background: linear-gradient(to right, #000080, #1084d0);
            padding: 3px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .title-text {
            color: white;
            font-weight: bold;
            font-size: 14px;
            padding-left: 5px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .title-icon {
            width: 16px;
            height: 16px;
            image-rendering: pixelated;
        }

        .window-controls {
            display: flex;
            gap: 2px;
        }

        .window-btn {
            width: 18px;
            height: 18px;
            background: #c0c0c0;
            border: 1px solid;
            border-color: #ffffff #000000 #000000 #ffffff;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-weight: bold;
        }

        .window-btn:active {
            border-color: #000000 #ffffff #ffffff #000000;
        }

        .menu-bar {
            background: #c0c0c0;
            border-bottom: 2px solid;
            border-color: #dfdfdf #808080 #808080 #dfdfdf;
            padding: 2px 5px;
            font-size: 13px;
            position: relative;
        }

        .menu-item {
            display: inline-block;
            padding: 3px 8px;
            cursor: pointer;
            position: relative;
        }

        .menu-item:hover, .menu-item.active {
            background: #000080;
            color: white;
        }

        .dropdown-menu {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            background: #c0c0c0;
            border: 2px solid;
            border-color: #dfdfdf #808080 #808080 #dfdfdf;
            box-shadow: 2px 2px 0 rgba(0,0,0,0.2);
            min-width: 180px;
            z-index: 1000;
        }

        .dropdown-menu.show {
            display: block;
        }

        .dropdown-item {
            padding: 5px 20px;
            cursor: pointer;
            white-space: nowrap;
        }

        .dropdown-item:hover {
            background: #000080;
            color: white;
        }

        .dropdown-separator {
            height: 0;
            border-top: 1px solid #808080;
            border-bottom: 1px solid #dfdfdf;
            margin: 2px 0;
        }

        .toolbar {
            background: #c0c0c0;
            padding: 5px;
            border-bottom: 2px solid;
            border-color: #dfdfdf #808080 #808080 #dfdfdf;
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .stat-group {
            background: #ffffff;
            border: 2px solid;
            border-color: #808080 #dfdfdf #dfdfdf #808080;
            padding: 4px 8px;
            font-size: 13px;
            display: flex;
            gap: 15px;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .stat-label {
            font-weight: bold;
        }

        .stat-value {
            color: #000080;
            font-weight: bold;
        }

        .content-area {
            background: #c0c0c0;
            padding: 8px;
            display: flex;
            justify-content: center;
        }

        .game-frame {
            background: #ffffff;
            border: 2px solid;
            border-color: #808080 #dfdfdf #dfdfdf #808080;
            position: relative;
            width: fit-content;
        }

        canvas {
            display: block;
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }

        .overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #c0c0c0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 2px solid;
            border-color: #dfdfdf #808080 #808080 #dfdfdf;
        }

        .dialog-box {
            background: #c0c0c0;
            border: 2px solid;
            border-color: #dfdfdf #808080 #808080 #dfdfdf;
            padding: 15px;
            min-width: 400px;
        }

        .dialog-title {
            background: linear-gradient(to right, #000080, #1084d0);
            color: white;
            padding: 3px 5px;
            font-weight: bold;
            font-size: 14px;
            margin: -15px -15px 10px -15px;
        }

        .dialog-content {
            padding: 15px;
            background: #ffffff;
            border: 2px solid;
            border-color: #808080 #dfdfdf #dfdfdf #808080;
            margin-bottom: 15px;
        }

        .dialog-content h2 {
            color: #000080;
            margin-bottom: 10px;
            font-size: 18px;
        }

        .legend {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 10px 0;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 5px;
            background: #f0f0f0;
            border: 1px solid #808080;
        }

        .kitty-preview {
            width: 32px;
            height: 32px;
            image-rendering: pixelated;
        }

        .legend-text {
            font-size: 12px;
        }

        .win98-btn {
            background: #c0c0c0;
            border: 2px solid;
            border-color: #ffffff #000000 #000000 #ffffff;
            padding: 8px 20px;
            font-family: inherit;
            font-size: 13px;
            cursor: pointer;
            font-weight: bold;
            min-width: 80px;
        }

        .win98-btn:hover {
            background: #d4d4d4;
        }

        .win98-btn:active {
            border-color: #000000 #ffffff #ffffff #000000;
            padding: 9px 19px 7px 21px;
        }

        .status-bar {
            background: #c0c0c0;
            border-top: 2px solid;
            border-color: #dfdfdf #808080 #808080 #dfdfdf;
            padding: 3px 5px;
            font-size: 12px;
            display: flex;
            gap: 10px;
        }

        .status-section {
            border: 2px solid;
            border-color: #808080 #dfdfdf #dfdfdf #808080;
            padding: 2px 8px;
        }

        .game-over-screen {
            display: none;
        }

        .pause-overlay {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 999;
            align-items: center;
            justify-content: center;
        }

        .pause-overlay.show {
            display: flex;
        }

        .pause-message {
            background: #c0c0c0;
            border: 3px solid;
            border-color: #dfdfdf #808080 #808080 #dfdfdf;
            padding: 30px 50px;
            font-size: 32px;
            font-weight: bold;
            color: #000080;
            text-align: center;
        }

        .settings-dialog {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10000;
            min-width: 500px;
        }

        .settings-dialog.show {
            display: block;
        }

        .theme-selector {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 15px 0;
        }

        .theme-card {
            background: #f0f0f0;
            border: 3px solid #808080;
            padding: 15px;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
        }

        .theme-card:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .theme-card.selected {
            border-color: #000080;
            background: #d4d4ff;
            box-shadow: 0 0 10px rgba(0, 0, 128, 0.3);
        }

        .theme-preview {
            width: 100%;
            height: 80px;
            margin-bottom: 10px;
            border: 2px solid #808080;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
        }

        .theme-card-retro .theme-preview {
            background: #008080;
            image-rendering: pixelated;
        }

        .theme-card-aero .theme-preview {
            background: linear-gradient(135deg, #B5E3FF 0%, #7FBA00 100%);
            border-radius: 8px;
        }

        .theme-card-y2k .theme-preview {
            background: linear-gradient(135deg, #000000 0%, #1a0033 100%);
            box-shadow: 0 0 20px rgba(255, 20, 147, 0.5);
        }

        .settings-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 9999;
        }

        .settings-overlay.show {
            display: block;
        }

        .collectible-info {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin: 10px 0;
        }

        .collectible-badge {
            background: #f0f0f0;
            border: 1px solid #808080;
            padding: 5px 8px;
            font-size: 11px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .win98-input {
            background: #ffffff;
            border: 2px solid;
            border-color: #808080 #dfdfdf #dfdfdf #808080;
            padding: 4px 8px;
            font-family: inherit;
            font-size: 13px;
            width: 100%;
        }

        .paddle-option {
            background: #f0f0f0;
            border: 3px solid #808080;
            padding: 15px;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
        }

        .paddle-option:hover {
            background: #e0e0e0;
        }

        .paddle-option.selected {
            border-color: #000080;
            background: #d4d4ff;
        }

        .paddle-preview {
            font-size: 48px;
            margin-bottom: 10px;
        }

        @media (max-width: 900px) {
            .dialog-box {
                min-width: auto;
                max-width: 90vw;
            }

            .legend {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="window">
        <div class="title-bar">
            <div class="title-text">
                <span>üê±</span>
                <span>Kitty Bounce '98</span>
            </div>
            <div class="window-controls">
                <div class="window-btn" onclick="minimizeWindow()">_</div>
                <div class="window-btn" onclick="maximizeWindow()">‚ñ°</div>
                <div class="window-btn" onclick="if(confirm('Are you sure you want to quit?')) window.close()">√ó</div>
            </div>
        </div>

        <div class="menu-bar">
            <span class="menu-item" id="fileMenu">
                File
                <div class="dropdown-menu" id="fileDropdown">
                    <div class="dropdown-item" onclick="newGame()">New Game</div>
                    <div class="dropdown-item" onclick="viewHighScores()">High Scores</div>
                    <div class="dropdown-separator"></div>
                    <div class="dropdown-item" onclick="exitGame()">Exit</div>
                </div>
            </span>
            <span class="menu-item" id="gameMenu">
                Game
                <div class="dropdown-menu" id="gameDropdown">
                    <div class="dropdown-item" onclick="togglePause()">Pause/Resume</div>
                    <div class="dropdown-item" onclick="restartCurrentGame()">Restart</div>
                    <div class="dropdown-separator"></div>
                    <div class="dropdown-item" onclick="showDifficultySettings()">Difficulty Settings</div>
                </div>
            </span>
            <span class="menu-item" id="optionsMenu">
                Options
                <div class="dropdown-menu" id="optionsDropdown">
                    <div class="dropdown-item" onclick="showSettings()">UI Settings</div>
                    <div class="dropdown-separator"></div>
                    <div class="dropdown-item" onclick="toggleSound()">Sound: <span id="soundStatus">ON</span></div>
                    <div class="dropdown-item" onclick="toggleMusic()">Music: <span id="musicStatus">ON</span></div>
                    <div class="dropdown-separator"></div>
                    <div class="dropdown-item" onclick="showVolumeControls()">Volume Controls</div>
                </div>
            </span>
            <span class="menu-item" id="helpMenu">
                Help
                <div class="dropdown-menu" id="helpDropdown">
                    <div class="dropdown-item" onclick="showHowToPlay()">How to Play</div>
                    <div class="dropdown-item" onclick="showControls()">Controls Reference</div>
                    <div class="dropdown-separator"></div>
                    <div class="dropdown-item" onclick="showAbout()">About</div>
                </div>
            </span>
        </div>

        <div class="toolbar">
            <div class="stat-group">
                <div class="stat-item">
                    <span class="stat-label">Score:</span>
                    <span class="stat-value" id="score">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Lives:</span>
                    <span class="stat-value" id="lives">3</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">High Score:</span>
                    <span class="stat-value" id="highScore">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Level:</span>
                    <span class="stat-value" id="level">1</span>
                </div>
            </div>
        </div>

        <div class="content-area">
            <div class="game-frame">
                <canvas id="gameCanvas" width="800" height="600"></canvas>

                <div class="overlay" id="startScreen">
                    <div class="dialog-box">
                        <div class="dialog-title">Kitty Bounce '98 - New Game</div>
                        <div class="dialog-content">
                            <h2>Welcome to Kitty Bounce!</h2>
                            <p><strong>Controls:</strong> Use Mouse or Arrow Keys (‚Üê ‚Üí)</p>
                            <p style="margin-top: 10px;"><strong>Objective:</strong> Bounce kitties and collect items!</p>

                            <div style="margin-top: 15px;">
                                <strong>Meet the Kitties:</strong>
                                <div class="legend">
                                    <div class="legend-item">
                                        <canvas class="kitty-preview" id="preview1" width="32" height="32"></canvas>
                                        <div class="legend-text">
                                            <strong>Orange Tabby</strong><br>
                                            <small>10 pts ‚Ä¢ Common</small>
                                        </div>
                                    </div>
                                    <div class="legend-item">
                                        <canvas class="kitty-preview" id="preview2" width="32" height="32"></canvas>
                                        <div class="legend-text">
                                            <strong>Black Cat</strong><br>
                                            <small>20 pts ‚Ä¢ Uncommon</small>
                                        </div>
                                    </div>
                                    <div class="legend-item">
                                        <canvas class="kitty-preview" id="preview3" width="32" height="32"></canvas>
                                        <div class="legend-text">
                                            <strong>White Cat</strong><br>
                                            <small>30 pts ‚Ä¢ Rare</small>
                                        </div>
                                    </div>
                                    <div class="legend-item">
                                        <canvas class="kitty-preview" id="preview4" width="32" height="32"></canvas>
                                        <div class="legend-text">
                                            <strong>Calico</strong><br>
                                            <small>50 pts ‚Ä¢ Very Rare</small>
                                        </div>
                                    </div>
                                    <div class="legend-item">
                                        <canvas class="kitty-preview" id="preview5" width="32" height="32"></canvas>
                                        <div class="legend-text">
                                            <strong>Golden Cat</strong><br>
                                            <small>100 pts ‚Ä¢ Legendary!</small>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div style="margin-top: 15px;">
                                <strong>Collectibles:</strong>
                                <div class="collectible-info">
                                    <div class="collectible-badge">üêü Fish +5</div>
                                    <div class="collectible-badge">üß∂ Yarn +10</div>
                                    <div class="collectible-badge">üíù Heart +15</div>
                                    <div class="collectible-badge">‚≠ê Star +25</div>
                                </div>
                            </div>

                            <div style="margin-top: 15px;">
                                <strong>Enter Your Name:</strong>
                                <input type="text" id="playerName" class="win98-input"
                                       placeholder="Player" maxlength="20"
                                       style="margin-top: 5px;">
                            </div>
                        </div>
                        <center>
                            <button class="win98-btn" onclick="startGame()">Start Game</button>
                        </center>
                    </div>
                </div>

                <div class="overlay" id="paddleSelectScreen" style="display: none;">
                    <div class="dialog-box">
                        <div class="dialog-title">Choose Your Cat Toy</div>
                        <div class="dialog-content">
                            <h2>Select Your Paddle Design</h2>
                            <div id="paddleOptions" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin: 15px 0;">
                            </div>
                        </div>
                        <center>
                            <button class="win98-btn" onclick="confirmPaddleSelection()">Continue</button>
                        </center>
                    </div>
                </div>

                <div class="overlay game-over-screen" id="gameOverScreen">
                    <div class="dialog-box">
                        <div class="dialog-title">Game Over</div>
                        <div class="dialog-content">
                            <h2 id="gameOverTitle">Game Over!</h2>
                            <p id="highScoreMessage" style="color: #FF8C00; font-weight: bold; display: none; margin-bottom: 10px;">
                                üéâ NEW HIGH SCORE! üéâ
                            </p>
                            <p style="font-size: 16px; margin: 15px 0;">
                                <strong>Final Score:</strong> <span id="finalScore" style="color: #000080; font-size: 24px;">0</span>
                            </p>
                            <p>
                                <strong>Level Reached:</strong> <span id="finalLevel">1</span>
                            </p>
                        </div>
                        <center style="display: flex; gap: 10px; justify-content: center;">
                            <button class="win98-btn" onclick="returnToHome()">Return to Home</button>
                            <button class="win98-btn" onclick="restartGame()">Play Again</button>
                        </center>
                    </div>
                </div>

                <div class="pause-overlay" id="pauseOverlay">
                    <div class="pause-message">
                        ‚è∏Ô∏è PAUSED ‚è∏Ô∏è<br>
                        <span style="font-size: 18px; font-weight: normal;">Press ESC or Spacebar to resume</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="status-bar">
            <div class="status-section">Ready</div>
            <div class="status-section" id="statusMessage">Press Start to begin</div>
        </div>
    </div>

    <!-- Settings Dialog -->
    <div class="settings-overlay" id="settingsOverlay" onclick="closeSettings()"></div>
    <div class="settings-dialog" id="settingsDialog">
        <div class="dialog-box">
            <div class="dialog-title">‚öôÔ∏è UI Settings</div>
            <div class="dialog-content">
                <h2>Choose Your UI Style</h2>
                <p style="margin-bottom: 15px;">Select a visual theme for your gaming experience</p>

                <div class="theme-selector">
                    <div class="theme-card theme-card-retro" onclick="selectTheme('retro')">
                        <div class="theme-preview">üéÆ</div>
                        <strong>Retro Pixel</strong><br>
                        <small>Classic Windows 98</small>
                    </div>

                    <div class="theme-card theme-card-aero" onclick="selectTheme('aero')">
                        <div class="theme-preview">üíé</div>
                        <strong>Frutiger Aero</strong><br>
                        <small>Mid-2000s Vista/7</small>
                    </div>

                    <div class="theme-card theme-card-y2k" onclick="selectTheme('y2k')">
                        <div class="theme-preview">‚ö°</div>
                        <strong>Y2K Edgy</strong><br>
                        <small>Cyber Chrome</small>
                    </div>
                </div>
            </div>
            <center>
                <button class="win98-btn" onclick="closeSettings()">Close</button>
            </center>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        ctx.imageSmoothingEnabled = false;

        // Game state
        let gameRunning = false;
        let gamePaused = false;
        let animationId = null;
        let score = 0;
        let lives = 3;
        let level = 1;
        let difficulty = 'medium'; // easy, medium, hard
        let soundEnabled = true;
        let musicEnabled = true;
        let masterVolume = 0.7;
        let highScore = localStorage.getItem('kittyBounce98HighScore') || 0;
        document.getElementById('highScore').textContent = highScore;

        // Theme System
        let currentTheme = localStorage.getItem('kittyBounce98Theme') || 'retro';

        const themes = {
            retro: {
                name: 'Retro Pixel',
                description: 'Classic Windows 98 pixel art style',
                colors: {
                    primary: '#000080',
                    secondary: '#008080',
                    accent: '#c0c0c0',
                    text: '#000000',
                    bg: '#c0c0c0'
                }
            },
            aero: {
                name: 'Frutiger Aero',
                description: 'Mid-2000s glossy Vista/7 aesthetic',
                colors: {
                    primary: '#0078D7',
                    secondary: '#00BCF2',
                    accent: '#7FBA00',
                    text: '#FFFFFF',
                    bg: 'rgba(240, 248, 255, 0.9)'
                }
            },
            y2k: {
                name: 'Y2K Edgy',
                description: 'Late 90s cyber chrome aesthetic',
                colors: {
                    primary: '#FF1493',
                    secondary: '#00FFFF',
                    accent: '#C0C0C0',
                    text: '#00FFFF',
                    bg: '#000000'
                }
            }
        };

        function applyTheme(themeName) {
            currentTheme = themeName;
            localStorage.setItem('kittyBounce98Theme', themeName);

            const root = document.documentElement;
            const theme = themes[themeName];

            // Apply CSS variables for UI
            root.style.setProperty('--theme-primary', theme.colors.primary);
            root.style.setProperty('--theme-secondary', theme.colors.secondary);
            root.style.setProperty('--theme-accent', theme.colors.accent);
            root.style.setProperty('--theme-text', theme.colors.text);
            root.style.setProperty('--theme-bg', theme.colors.bg);

            // Apply theme class to body
            document.body.className = `theme-${themeName}`;

            // Update window title if game is running (redraw canvas)
            if (gameRunning) {
                // Redraw everything with new theme
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                drawBackground();
                drawKitties();
                drawPaddle();
                drawParticles();
            }

            updateStatus(`Theme changed to ${theme.name}`);
        }

        // Apply saved theme on load
        applyTheme(currentTheme);

        // Dropdown menu system
        document.querySelectorAll('.menu-item').forEach(menuItem => {
            menuItem.addEventListener('click', function(e) {
                e.stopPropagation();
                const dropdown = this.querySelector('.dropdown-menu');
                const wasOpen = dropdown && dropdown.classList.contains('show');

                // Close all dropdowns
                document.querySelectorAll('.dropdown-menu').forEach(d => d.classList.remove('show'));
                document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('active'));

                // Toggle current dropdown
                if (dropdown && !wasOpen) {
                    dropdown.classList.add('show');
                    this.classList.add('active');
                }
            });
        });

        // Close dropdowns when clicking outside
        document.addEventListener('click', function() {
            document.querySelectorAll('.dropdown-menu').forEach(d => d.classList.remove('show'));
            document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('active'));
        });

        // Prevent dropdown items from closing parent dropdown
        document.querySelectorAll('.dropdown-menu').forEach(dropdown => {
            dropdown.addEventListener('click', function(e) {
                e.stopPropagation();
            });
        });

        // Menu Functions - File Menu
        function newGame() {
            returnToHome();
            document.querySelectorAll('.dropdown-menu').forEach(d => d.classList.remove('show'));
            updateStatus('Starting new game...');
        }

        function viewHighScores() {
            const playerName = localStorage.getItem('kittyBounce98PlayerName') || 'Player';
            alert(`üèÜ High Scores üèÜ\n\n${playerName}: ${highScore} points\n\nKeep playing to beat your record!`);
            document.querySelectorAll('.dropdown-menu').forEach(d => d.classList.remove('show'));
        }

        function exitGame() {
            if (confirm('Are you sure you want to exit Kitty Bounce \'98?')) {
                window.close();
            }
            document.querySelectorAll('.dropdown-menu').forEach(d => d.classList.remove('show'));
        }

        // Menu Functions - Game Menu
        function togglePause() {
            if (!gameRunning) {
                alert('No game in progress!');
                return;
            }
            gamePaused = !gamePaused;
            if (gamePaused) {
                updateStatus('Game Paused - Press ESC or Spacebar to resume');
                showPauseOverlay();
            } else {
                updateStatus('Game Resumed');
                hidePauseOverlay();
                gameLoop();
            }
            document.querySelectorAll('.dropdown-menu').forEach(d => d.classList.remove('show'));
        }

        function restartCurrentGame() {
            if (confirm('Restart current game? Your progress will be lost.')) {
                restartGame();
            }
            document.querySelectorAll('.dropdown-menu').forEach(d => d.classList.remove('show'));
        }

        function showDifficultySettings() {
            const current = difficulty.charAt(0).toUpperCase() + difficulty.slice(1);
            const choice = prompt(`Select Difficulty:\n\n1. Easy (Slower, 5 lives)\n2. Medium (Normal speed, 3 lives)\n3. Hard (Faster, 3 lives, fewer collectibles)\n\nCurrent: ${current}\n\nEnter 1, 2, or 3:`);

            if (choice === '1') {
                difficulty = 'easy';
                updateStatus('Difficulty set to Easy');
            } else if (choice === '2') {
                difficulty = 'medium';
                updateStatus('Difficulty set to Medium');
            } else if (choice === '3') {
                difficulty = 'hard';
                updateStatus('Difficulty set to Hard');
            }
            document.querySelectorAll('.dropdown-menu').forEach(d => d.classList.remove('show'));
        }

        // Menu Functions - Options Menu
        function toggleSound() {
            soundEnabled = !soundEnabled;
            document.getElementById('soundStatus').textContent = soundEnabled ? 'ON' : 'OFF';
            updateStatus(`Sound ${soundEnabled ? 'enabled' : 'disabled'}`);
        }

        function toggleMusic() {
            musicEnabled = !musicEnabled;
            document.getElementById('musicStatus').textContent = musicEnabled ? 'ON' : 'OFF';
            if (backgroundMusic) {
                if (musicEnabled) {
                    backgroundMusic.play().catch(e => console.log('Music play failed:', e));
                } else {
                    backgroundMusic.pause();
                }
            }
            updateStatus(`Music ${musicEnabled ? 'enabled' : 'disabled'}`);
        }

        function showVolumeControls() {
            const newVolume = prompt(`Set Master Volume (0-100):\n\nCurrent: ${Math.round(masterVolume * 100)}%`);
            if (newVolume !== null && !isNaN(newVolume)) {
                masterVolume = Math.max(0, Math.min(100, parseInt(newVolume))) / 100;
                updateStatus(`Volume set to ${Math.round(masterVolume * 100)}%`);
                // Update all audio volumes
                if (backgroundMusic) backgroundMusic.volume = masterVolume * 0.3;
            }
            document.querySelectorAll('.dropdown-menu').forEach(d => d.classList.remove('show'));
        }

        function showSettings() {
            document.getElementById('settingsOverlay').classList.add('show');
            document.getElementById('settingsDialog').classList.add('show');
            updateThemeSelection();
            document.querySelectorAll('.dropdown-menu').forEach(d => d.classList.remove('show'));
        }

        function closeSettings() {
            document.getElementById('settingsOverlay').classList.remove('show');
            document.getElementById('settingsDialog').classList.remove('show');
        }

        function selectTheme(themeName) {
            applyTheme(themeName);
            updateThemeSelection();
        }

        function updateThemeSelection() {
            document.querySelectorAll('.theme-card').forEach(card => {
                card.classList.remove('selected');
            });
            document.querySelector(`.theme-card-${currentTheme}`).classList.add('selected');
        }

        // Menu Functions - Help Menu
        function showHowToPlay() {
            alert('üéÆ How to Play Kitty Bounce \'98 üéÆ\n\n' +
                  '1. Move your paddle left/right using arrow keys or mouse\n' +
                  '2. Bounce falling kitties to score points\n' +
                  '3. Collect falling items for bonus points\n' +
                  '4. Don\'t let kitties fall! You lose a life each time\n' +
                  '5. Level up every 200 points\n' +
                  '6. Beat your high score!\n\n' +
                  'Rare kitties are worth more points!');
            document.querySelectorAll('.dropdown-menu').forEach(d => d.classList.remove('show'));
        }

        function showControls() {
            alert('‚å®Ô∏è Controls Reference ‚å®Ô∏è\n\n' +
                  '‚Üê ‚Üí Arrow Keys: Move paddle\n' +
                  'Mouse: Move paddle\n' +
                  'Spacebar/ESC: Pause/Resume\n\n' +
                  'Use the menu bar for more options!');
            document.querySelectorAll('.dropdown-menu').forEach(d => d.classList.remove('show'));
        }

        function showAbout() {
            alert('üê± Kitty Bounce \'98 üê±\n\n' +
                  'Version 2.0\n\n' +
                  'A retro-styled arcade game where you bounce falling kitties!\n\n' +
                  'Created with ‚ù§Ô∏è and nostalgia for the Windows 98 era.\n\n' +
                  '¬© 2024 Kitty Bounce Games');
            document.querySelectorAll('.dropdown-menu').forEach(d => d.classList.remove('show'));
        }

        // Window Control Functions
        function minimizeWindow() {
            const window = document.querySelector('.window');
            const isMinimized = window.classList.contains('minimized');

            if (isMinimized) {
                window.classList.remove('minimized');
                updateStatus('Window restored');
            } else {
                window.classList.add('minimized');
                updateStatus('Window minimized - Click minimize button to restore');
            }
        }

        function maximizeWindow() {
            const window = document.querySelector('.window');
            const isMaximized = window.classList.contains('maximized');

            if (isMaximized) {
                window.classList.remove('maximized');
                updateStatus('Window restored to normal size');
            } else {
                window.classList.add('maximized');
                updateStatus('Window maximized');
            }
        }

        // Define kitty types with pixel art
        const kittyTypes = [
            { name: 'Orange Tabby', color: '#FF8C00', stripes: '#D2691E', points: 10, weight: 40, speed: 1 },
            { name: 'Black Cat', color: '#1a1a1a', stripes: '#000000', points: 20, weight: 30, speed: 1.2 },
            { name: 'White Cat', color: '#FFFFFF', stripes: '#F0F0F0', points: 30, weight: 15, speed: 1.4 },
            { name: 'Calico', color: '#FF6B35', stripes: '#1a1a1a', points: 50, weight: 10, speed: 1.6 },
            { name: 'Golden Cat', color: '#FFD700', stripes: '#FFA500', points: 100, weight: 5, speed: 2 }
        ];

        // Paddle
        const paddle = {
            x: canvas.width / 2 - 60,
            y: canvas.height - 30,
            width: 120,
            height: 15,
            speed: 8,
            dx: 0
        };

        // Paddle designs with unique abilities
        const paddleDesigns = [
            {
                name: 'Cat Toy Stick',
                id: 'toy_stick',
                preview: 'üé£',
                description: 'Classic feather toy',
                width: 140,
                speed: 8,
                bounceMultiplier: 1.0,
                scoreMultiplier: 1.0,
                stats: 'Width: 140px | Speed: Normal'
            },
            {
                name: 'Cushion',
                id: 'cushion',
                preview: 'üõèÔ∏è',
                description: 'Soft and comfy',
                width: 120,
                speed: 6,
                bounceMultiplier: 1.3,
                scoreMultiplier: 1.0,
                stats: 'Width: 120px | Speed: Slow | Bounce: +30%'
            },
            {
                name: 'Mouse Toy',
                id: 'mouse',
                preview: 'üê≠',
                description: 'Squeaky mouse',
                width: 100,
                speed: 10,
                bounceMultiplier: 1.0,
                scoreMultiplier: 1.0,
                stats: 'Width: 100px | Speed: Fast'
            },
            {
                name: 'Laser Pointer',
                id: 'laser',
                preview: 'üî¥',
                description: 'Mesmerizing red dot',
                width: 80,
                speed: 8,
                bounceMultiplier: 1.0,
                scoreMultiplier: 1.5,
                stats: 'Width: 80px | Points: +50%'
            }
        ];

        let selectedPaddle = paddleDesigns[0];

        // Kitties (multiple!)
        let kitties = [];

        // Collectibles
        let collectibles = [];
        const collectibleTypes = [
            { icon: 'üêü', points: 5, weight: 40 },
            { icon: 'üß∂', points: 10, weight: 30 },
            { icon: 'üíù', points: 15, weight: 20 },
            { icon: '‚≠ê', points: 25, weight: 10 }
        ];

        let lastCollectibleTime = 0;
        const collectibleInterval = 2500;

        // Particle system for hit effects
        let particles = [];

        function spawnParticles(x, y, kittyType) {
            const numParticles = 8 + Math.floor(Math.random() * 5);

            // Color based on kitty rarity
            let particleColor = '#FFFFFF'; // Default white sparkles
            if (kittyType.points >= 100) particleColor = '#FFD700'; // Gold for legendary
            else if (kittyType.points >= 50) particleColor = '#FF69B4'; // Pink for very rare
            else if (kittyType.points >= 30) particleColor = '#00CED1'; // Cyan for rare
            else if (kittyType.points >= 20) particleColor = '#FFA500'; // Orange for uncommon

            for (let i = 0; i < numParticles; i++) {
                const angle = (Math.PI * 2 * i) / numParticles + (Math.random() - 0.5) * 0.5;
                const speed = 2 + Math.random() * 3;
                const type = Math.random() > 0.6 ? 'heart' : 'sparkle';

                particles.push({
                    x: x,
                    y: y,
                    vx: Math.cos(angle) * speed,
                    vy: Math.sin(angle) * speed,
                    life: 1.0,
                    decay: 0.015 + Math.random() * 0.01,
                    color: particleColor,
                    type: type,
                    size: 2 + Math.floor(Math.random() * 3)
                });
            }
        }

        function updateParticles() {
            for (let i = particles.length - 1; i >= 0; i--) {
                const p = particles[i];
                p.x += p.vx;
                p.y += p.vy;
                p.vy += 0.1; // Gravity
                p.life -= p.decay;

                if (p.life <= 0) {
                    particles.splice(i, 1);
                }
            }
        }

        function drawParticles() {
            particles.forEach(p => {
                ctx.save();
                ctx.globalAlpha = p.life;

                if (p.type === 'heart') {
                    // Pixel art heart
                    const pixelSize = p.size;
                    const heartPattern = [
                        [0,1,1,0,1,1,0],
                        [1,1,1,1,1,1,1],
                        [1,1,1,1,1,1,1],
                        [0,1,1,1,1,1,0],
                        [0,0,1,1,1,0,0],
                        [0,0,0,1,0,0,0]
                    ];

                    ctx.fillStyle = '#FF69B4';
                    heartPattern.forEach((row, y) => {
                        row.forEach((pixel, x) => {
                            if (pixel) {
                                ctx.fillRect(p.x + x * pixelSize, p.y + y * pixelSize, pixelSize, pixelSize);
                            }
                        });
                    });
                } else {
                    // Pixel art sparkle/star
                    const pixelSize = p.size;
                    ctx.fillStyle = p.color;

                    // Plus shape sparkle
                    ctx.fillRect(p.x + pixelSize, p.y, pixelSize, pixelSize * 3);
                    ctx.fillRect(p.x, p.y + pixelSize, pixelSize * 3, pixelSize);

                    // Brighter center
                    ctx.fillStyle = '#FFFFFF';
                    ctx.fillRect(p.x + pixelSize, p.y + pixelSize, pixelSize, pixelSize);
                }

                ctx.restore();
            });
        }

        // Pause overlay functions
        function showPauseOverlay() {
            document.getElementById('pauseOverlay').classList.add('show');
        }

        function hidePauseOverlay() {
            document.getElementById('pauseOverlay').classList.remove('show');
        }

        // Sound System using Web Audio API
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        let backgroundMusic = null;
        let musicOscillator = null;
        let musicGain = null;

        // Play a simple tone
        function playTone(frequency, duration, type = 'sine', volume = 0.3) {
            if (!soundEnabled) return;

            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            oscillator.frequency.value = frequency;
            oscillator.type = type;

            gainNode.gain.setValueAtTime(volume * masterVolume, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);

            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + duration);
        }

        // Sound Effects
        function playCatchSound() {
            // Meow-like sound (rising then falling pitch)
            playTone(400, 0.1, 'square', 0.2);
            setTimeout(() => playTone(600, 0.1, 'square', 0.2), 100);
            setTimeout(() => playTone(500, 0.15, 'square', 0.2), 200);
        }

        function playMissSound() {
            // Descending sad tone
            playTone(300, 0.1, 'sawtooth', 0.3);
            setTimeout(() => playTone(200, 0.1, 'sawtooth', 0.3), 100);
            setTimeout(() => playTone(150, 0.2, 'sawtooth', 0.3), 200);
        }

        function playCollectSound() {
            // Chime sound
            playTone(800, 0.1, 'sine', 0.25);
            setTimeout(() => playTone(1000, 0.15, 'sine', 0.25), 50);
        }

        function playLevelUpSound() {
            // Victory fanfare
            const notes = [523, 659, 784, 1047]; // C, E, G, C (major chord)
            notes.forEach((note, i) => {
                setTimeout(() => playTone(note, 0.2, 'triangle', 0.3), i * 100);
            });
        }

        function playGameOverSound() {
            // Descending game over sound
            const notes = [392, 349, 329, 293]; // G, F, E, D
            notes.forEach((note, i) => {
                setTimeout(() => playTone(note, 0.25, 'square', 0.25), i * 150);
            });
        }

        // Background Music - Simple looping melody
        function startBackgroundMusic() {
            if (!musicEnabled || musicOscillator) return;

            musicGain = audioContext.createGain();
            musicGain.connect(audioContext.destination);
            musicGain.gain.value = masterVolume * 0.15;

            const melody = [
                {freq: 523, duration: 0.3}, // C
                {freq: 659, duration: 0.3}, // E
                {freq: 784, duration: 0.3}, // G
                {freq: 659, duration: 0.3}, // E
                {freq: 698, duration: 0.3}, // F
                {freq: 784, duration: 0.3}, // G
                {freq: 880, duration: 0.6}, // A
                {freq: 784, duration: 0.3}, // G
                {freq: 659, duration: 0.3}, // E
                {freq: 523, duration: 0.6}  // C
            ];

            let currentNote = 0;
            let nextNoteTime = audioContext.currentTime;

            function playNextNote() {
                if (!musicEnabled) {
                    stopBackgroundMusic();
                    return;
                }

                const note = melody[currentNote];
                const osc = audioContext.createOscillator();
                osc.connect(musicGain);
                osc.frequency.value = note.freq;
                osc.type = 'square';
                osc.start(nextNoteTime);
                osc.stop(nextNoteTime + note.duration);

                nextNoteTime += note.duration;
                currentNote = (currentNote + 1) % melody.length;

                setTimeout(playNextNote, note.duration * 1000);
            }

            playNextNote();
        }

        function stopBackgroundMusic() {
            if (musicGain) {
                musicGain.disconnect();
                musicGain = null;
            }
        }

        // Input
        let keys = {};
        let mouseX = canvas.width / 2;

        document.addEventListener('keydown', (e) => {
            // Handle pause/resume
            if ((e.key === 'Escape' || e.key === ' ') && gameRunning) {
                e.preventDefault();
                togglePause();
                return;
            }
            keys[e.key] = true;
        });

        document.addEventListener('keyup', (e) => {
            keys[e.key] = false;
        });

        canvas.addEventListener('mousemove', (e) => {
            const rect = canvas.getBoundingClientRect();
            mouseX = e.clientX - rect.left;
        });

        // Aero-themed smooth gradient kitty
        function drawAeroKitty(x, y, size, type) {
            const radius = size / 2;

            // Soft gradient body
            const gradient = ctx.createRadialGradient(x, y, 0, x, y, radius);
            gradient.addColorStop(0, type.color);
            gradient.addColorStop(0.7, type.stripes);
            gradient.addColorStop(1, 'rgba(0, 0, 0, 0.2)');

            ctx.fillStyle = gradient;
            ctx.shadowBlur = 8;
            ctx.shadowColor = 'rgba(0, 0, 0, 0.3)';
            ctx.beginPath();
            ctx.arc(x, y, radius, 0, Math.PI * 2);
            ctx.fill();
            ctx.shadowBlur = 0;

            // Smooth eyes
            ctx.fillStyle = '#000000';
            ctx.beginPath();
            ctx.arc(x - radius/3, y - radius/4, radius/6, 0, Math.PI * 2);
            ctx.fill();
            ctx.beginPath();
            ctx.arc(x + radius/3, y - radius/4, radius/6, 0, Math.PI * 2);
            ctx.fill();

            // Highlight
            ctx.fillStyle = 'rgba(255, 255, 255, 0.4)';
            ctx.beginPath();
            ctx.arc(x - radius/3, y - radius/2, radius/3, 0, Math.PI * 2);
            ctx.fill();
        }

        // Y2K-themed cyber glitch kitty
        function drawY2KKitty(x, y, size, type) {
            const radius = size / 2;

            // Metallic chrome body
            const gradient = ctx.createLinearGradient(x - radius, y, x + radius, y);
            gradient.addColorStop(0, '#808080');
            gradient.addColorStop(0.3, '#E0E0E0');
            gradient.addColorStop(0.5, '#FFFFFF');
            gradient.addColorStop(0.7, '#C0C0C0');
            gradient.addColorStop(1, '#606060');

            ctx.fillStyle = gradient;
            ctx.shadowBlur = 12;
            ctx.shadowColor = type.points >= 50 ? '#FF1493' : '#00FFFF';
            ctx.beginPath();
            ctx.arc(x, y, radius, 0, Math.PI * 2);
            ctx.fill();

            // Neon outline
            ctx.strokeStyle = type.points >= 50 ? '#FF1493' : '#00FFFF';
            ctx.lineWidth = 2;
            ctx.stroke();
            ctx.shadowBlur = 0;

            // Digital glitch effect
            if (backgroundAnimFrame % 10 === 0) {
                ctx.fillStyle = 'rgba(0, 255, 255, 0.3)';
                ctx.fillRect(x - radius + Math.random() * radius, y - radius, radius/2, 2);
                ctx.fillStyle = 'rgba(255, 20, 147, 0.3)';
                ctx.fillRect(x, y + Math.random() * radius, radius/2, 2);
            }

            // Eyes
            ctx.fillStyle = '#00FFFF';
            ctx.fillRect(x - radius/3, y - radius/4, radius/4, radius/4);
            ctx.fillRect(x + radius/6, y - radius/4, radius/4, radius/4);
        }

        // Draw pixel art kitty
        function drawPixelKitty(ctx, x, y, size, type) {
            const pixelSize = size / 16;

            // Kitty pixel pattern (16x16)
            const pattern = [
                [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                [0,0,1,1,0,0,0,0,0,0,0,0,1,1,0,0],
                [0,1,2,2,1,0,0,0,0,0,0,1,2,2,1,0],
                [0,1,2,2,2,1,1,1,1,1,1,2,2,2,1,0],
                [0,0,1,2,2,2,2,2,2,2,2,2,2,1,0,0],
                [0,0,0,1,2,2,2,2,2,2,2,2,1,0,0,0],
                [0,0,1,2,2,3,3,2,2,3,3,2,2,1,0,0],
                [0,0,1,2,2,3,3,2,2,3,3,2,2,1,0,0],
                [0,0,1,2,2,2,2,2,2,2,2,2,2,1,0,0],
                [0,0,1,2,2,2,4,4,4,4,2,2,2,1,0,0],
                [0,0,1,2,2,4,2,2,2,2,4,2,2,1,0,0],
                [0,0,1,2,2,2,4,4,4,4,2,2,2,1,0,0],
                [0,0,0,1,2,2,2,2,2,2,2,2,1,0,0,0],
                [0,0,0,0,1,1,2,2,2,2,1,1,0,0,0,0],
                [0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0],
                [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
            ];

            const colors = {
                0: 'transparent',
                1: '#000000',        // outline
                2: type.color,       // main color
                3: '#000000',        // eyes
                4: '#FF69B4'         // nose/mouth
            };

            // Add stripes for tabby patterns
            if (type.name === 'Orange Tabby' || type.name === 'Calico') {
                for (let row = 0; row < 16; row++) {
                    for (let col = 0; col < 16; col++) {
                        if (pattern[row][col] === 2 && (row % 3 === 0 || col % 4 === 0)) {
                            ctx.fillStyle = type.stripes;
                            ctx.fillRect(x - size/2 + col * pixelSize, y - size/2 + row * pixelSize, pixelSize, pixelSize);
                        }
                    }
                }
            }

            // Draw main pattern
            for (let row = 0; row < 16; row++) {
                for (let col = 0; col < 16; col++) {
                    const colorKey = pattern[row][col];
                    if (colorKey !== 0) {
                        ctx.fillStyle = colors[colorKey];
                        ctx.fillRect(x - size/2 + col * pixelSize, y - size/2 + row * pixelSize, pixelSize, pixelSize);
                    }
                }
            }
        }

        // Initialize preview kitties
        function initPreviews() {
            kittyTypes.forEach((type, index) => {
                const previewCanvas = document.getElementById(`preview${index + 1}`);
                if (previewCanvas) {
                    const previewCtx = previewCanvas.getContext('2d');
                    previewCtx.imageSmoothingEnabled = false;
                    drawPixelKitty(previewCtx, 16, 16, 24, type);
                }
            });
        }

        initPreviews();

        function spawnKitty() {
            const totalWeight = kittyTypes.reduce((sum, type) => sum + type.weight, 0);
            let random = Math.random() * totalWeight;

            let selectedType = kittyTypes[0];
            for (let type of kittyTypes) {
                random -= type.weight;
                if (random <= 0) {
                    selectedType = type;
                    break;
                }
            }

            // Apply difficulty speed multiplier
            let speedMultiplier = 1.0;
            if (difficulty === 'easy') speedMultiplier = 0.7;
            if (difficulty === 'hard') speedMultiplier = 1.4;

            const kitty = {
                x: Math.random() * (canvas.width - 60) + 30,
                y: 100,
                radius: 20,
                dx: (Math.random() - 0.5) * 6 * speedMultiplier,
                dy: (3 + Math.random() * 2) * speedMultiplier,
                type: selectedType,
                rotation: 0,
                rotationSpeed: 0.05,
                squashFactor: 1.0,
                bounceCount: 0,
                showEmotion: false,
                emotionTimer: 0
            };

            kitties.push(kitty);
            updateStatus(`${selectedType.name} appeared! Worth ${selectedType.points} pts`);
        }

        function spawnCollectible() {
            const totalWeight = collectibleTypes.reduce((sum, type) => sum + type.weight, 0);
            let random = Math.random() * totalWeight;

            let selectedType = collectibleTypes[0];
            for (let type of collectibleTypes) {
                random -= type.weight;
                if (random <= 0) {
                    selectedType = type;
                    break;
                }
            }

            collectibles.push({
                x: Math.random() * (canvas.width - 40) + 20,
                y: -30,
                size: 20,
                type: selectedType,
                dy: 2 + Math.random() * 2
            });
        }

        function startGame() {
            const playerName = document.getElementById('playerName').value.trim() || 'Player';
            localStorage.setItem('kittyBounce98PlayerName', playerName);

            document.getElementById('startScreen').style.display = 'none';
            showPaddleSelection();
        }

        function showPaddleSelection() {
            const screen = document.getElementById('paddleSelectScreen');
            const optionsContainer = document.getElementById('paddleOptions');

            optionsContainer.innerHTML = '';
            paddleDesigns.forEach((design, index) => {
                const option = document.createElement('div');
                option.className = 'paddle-option';
                if (index === 0) option.classList.add('selected');
                option.innerHTML = `
                    <div class="paddle-preview">${design.preview}</div>
                    <strong>${design.name}</strong><br>
                    <small>${design.description}</small><br>
                    <small style="color: #000080; font-weight: bold; margin-top: 5px; display: block;">${design.stats}</small>
                `;
                option.onclick = () => selectPaddle(index, option);
                optionsContainer.appendChild(option);
            });

            screen.style.display = 'flex';
        }

        function selectPaddle(index, element) {
            document.querySelectorAll('.paddle-option').forEach(opt => {
                opt.classList.remove('selected');
            });

            element.classList.add('selected');
            selectedPaddle = paddleDesigns[index];
        }

        function confirmPaddleSelection() {
            // Apply paddle stats
            paddle.width = selectedPaddle.width;
            paddle.speed = selectedPaddle.speed;

            // Apply difficulty settings
            if (difficulty === 'easy') {
                lives = 5;
            } else {
                lives = 3;
            }
            updateLives();

            document.getElementById('paddleSelectScreen').style.display = 'none';
            gameRunning = true;
            lastCollectibleTime = Date.now();
            resetGame();
            spawnKitty();
            gameLoop();
            startBackgroundMusic();
            updateStatus(`Game started with ${selectedPaddle.name}!`);
        }

        function restartGame() {
            console.log('Restarting game...');

            // Stop any running game and cancel animations
            gameRunning = false;
            if (animationId) {
                cancelAnimationFrame(animationId);
                animationId = null;
            }

            stopBackgroundMusic();

            // Hide game over screen
            document.getElementById('gameOverScreen').style.display = 'none';

            // Reset all game state
            score = 0;
            if (difficulty === 'easy') {
                lives = 5;
            } else {
                lives = 3;
            }
            level = 1;
            kitties = [];
            collectibles = [];
            particles = [];
            lastCollectibleTime = Date.now();

            // Update UI
            updateScore();
            updateLives();
            updateLevel();

            // Reset paddle position and stats
            paddle.width = selectedPaddle.width;
            paddle.speed = selectedPaddle.speed;
            resetGame();

            // Clear canvas and draw background
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawBackground();
            drawPaddle();

            // Spawn first kitty
            spawnKitty();
            console.log('Kitty spawned:', kitties.length);

            // Start game
            gameRunning = true;
            startBackgroundMusic();
            updateStatus('Game restarted! Good luck!');

            // Start game loop immediately
            animationId = requestAnimationFrame(gameLoop);
            console.log('Game loop started');
        }

        function resetGame() {
            paddle.x = canvas.width / 2 - paddle.width / 2;
        }

        function returnToHome() {
            gameRunning = false;
            if (animationId) {
                cancelAnimationFrame(animationId);
                animationId = null;
            }

            stopBackgroundMusic();

            document.getElementById('gameOverScreen').style.display = 'none';
            document.getElementById('highScoreMessage').style.display = 'none';
            document.getElementById('startScreen').style.display = 'flex';

            score = 0;
            lives = 3;
            level = 1;
            kitties = [];
            collectibles = [];
            particles = [];

            updateScore();
            updateLives();
            updateLevel();

            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawBackground();

            updateStatus('Ready to play again!');
        }

        function updatePaddle() {
            if (keys['ArrowLeft'] && paddle.x > 0) {
                paddle.x -= paddle.speed;
            }
            if (keys['ArrowRight'] && paddle.x + paddle.width < canvas.width) {
                paddle.x += paddle.speed;
            }

            const targetX = mouseX - paddle.width / 2;
            const diff = targetX - paddle.x;
            paddle.x += diff * 0.2;

            if (paddle.x < 0) paddle.x = 0;
            if (paddle.x + paddle.width > canvas.width) paddle.x = canvas.width - paddle.width;
        }

        function updateKitties() {
            for (let i = kitties.length - 1; i >= 0; i--) {
                const kitty = kitties[i];

                kitty.x += kitty.dx * kitty.type.speed;
                kitty.y += kitty.dy * kitty.type.speed;
                kitty.rotation += kitty.rotationSpeed;

                // Decay animation effects
                kitty.rotationSpeed = Math.max(0.05, kitty.rotationSpeed * 0.95);
                kitty.squashFactor = Math.min(1.0, kitty.squashFactor + 0.05);
                if (kitty.emotionTimer > 0) {
                    kitty.emotionTimer--;
                    if (kitty.emotionTimer === 0) {
                        kitty.showEmotion = false;
                    }
                }

                // Wall collision
                if (kitty.x + kitty.radius > canvas.width || kitty.x - kitty.radius < 0) {
                    kitty.dx *= -1;
                }

                // Top collision
                if (kitty.y - kitty.radius < 0) {
                    kitty.dy *= -1;
                }

                // Paddle collision
                if (
                    kitty.y + kitty.radius > paddle.y &&
                    kitty.y + kitty.radius < paddle.y + paddle.height &&
                    kitty.x > paddle.x &&
                    kitty.x < paddle.x + paddle.width
                ) {
                    // Apply bounce multiplier (Cushion has higher bounce)
                    kitty.dy = -Math.abs(kitty.dy) * selectedPaddle.bounceMultiplier;
                    const hitPos = (kitty.x - paddle.x) / paddle.width;
                    kitty.dx = (hitPos - 0.5) * 8;

                    // Kitty reaction animations!
                    kitty.rotationSpeed = 0.15; // Triple the spin speed
                    kitty.squashFactor = 0.7; // Squash vertically
                    kitty.bounceCount++;
                    kitty.showEmotion = true;
                    kitty.emotionTimer = 20; // Show emotion for 20 frames

                    // Apply score multiplier (Laser Pointer gives bonus points)
                    const earnedPoints = Math.floor(kitty.type.points * selectedPaddle.scoreMultiplier);
                    score += earnedPoints;
                    updateScore();

                    // Spawn particles at collision point!
                    spawnParticles(kitty.x, paddle.y, kitty.type);

                    playCatchSound();

                    const bonusText = selectedPaddle.scoreMultiplier > 1 ? ` (Bonus!)` : '';
                    updateStatus(`Bounced ${kitty.type.name}! +${earnedPoints} pts${bonusText}`);
                }

                // Bottom boundary
                if (kitty.y - kitty.radius > canvas.height) {
                    kitties.splice(i, 1);
                    lives--;
                    updateLives();
                    playMissSound();
                    updateStatus(`Lost a ${kitty.type.name}! -1 life`);

                    if (lives <= 0) {
                        gameOver();
                    } else if (kitties.length === 0) {
                        setTimeout(() => spawnKitty(), 500);
                    }
                }
            }

            // Spawn new kitty occasionally
            if (kitties.length < level && Math.random() < 0.003) {
                spawnKitty();
            }
        }

        function updateCollectibles() {
            const currentTime = Date.now();
            // Adjust collectible spawn rate based on difficulty
            let spawnInterval = collectibleInterval;
            if (difficulty === 'easy') spawnInterval = collectibleInterval * 0.7; // More frequent
            if (difficulty === 'hard') spawnInterval = collectibleInterval * 1.5; // Less frequent

            if (currentTime - lastCollectibleTime > spawnInterval) {
                spawnCollectible();
                lastCollectibleTime = currentTime;
            }

            for (let i = collectibles.length - 1; i >= 0; i--) {
                const c = collectibles[i];
                c.y += c.dy;

                // Check collision with any kitty
                for (let kitty of kitties) {
                    const dist = Math.hypot(kitty.x - c.x, kitty.y - c.y);
                    if (dist < kitty.radius + c.size / 2) {
                        score += c.type.points;
                        updateScore();
                        playCollectSound();
                        updateStatus(`Collected ${c.type.icon}! +${c.type.points} pts`);
                        collectibles.splice(i, 1);
                        break;
                    }
                }

                if (c.y > canvas.height + 50) {
                    collectibles.splice(i, 1);
                }
            }
        }

        function drawPaddle() {
            // Dispatch based on theme
            if (currentTheme === 'aero') {
                drawAeroPaddle();
            } else if (currentTheme === 'y2k') {
                drawY2KPaddle();
            } else {
                // Retro pixel art paddles
                switch(selectedPaddle.id) {
                    case 'toy_stick':
                        drawToyStickPaddle();
                        break;
                    case 'cushion':
                        drawCushionPaddle();
                        break;
                    case 'mouse':
                        drawMousePaddle();
                        break;
                    case 'laser':
                        drawLaserPaddle();
                        break;
                    default:
                        drawToyStickPaddle();
                }
            }
        }

        // Aero-themed smooth gradient paddle
        function drawAeroPaddle() {
            const startX = paddle.x;
            const startY = paddle.y;

            // Glossy gradient paddle
            const gradient = ctx.createLinearGradient(startX, startY, startX, startY + paddle.height);
            gradient.addColorStop(0, 'rgba(255, 255, 255, 0.9)');
            gradient.addColorStop(0.5, 'rgba(0, 120, 215, 0.7)');
            gradient.addColorStop(1, 'rgba(0, 188, 242, 0.6)');

            ctx.fillStyle = gradient;
            ctx.shadowBlur = 10;
            ctx.shadowColor = 'rgba(0, 120, 215, 0.5)';
            ctx.beginPath();
            ctx.roundRect(startX, startY, paddle.width, paddle.height, 8);
            ctx.fill();
            ctx.shadowBlur = 0;

            // Highlight
            const highlightGradient = ctx.createLinearGradient(startX, startY, startX, startY + paddle.height / 2);
            highlightGradient.addColorStop(0, 'rgba(255, 255, 255, 0.6)');
            highlightGradient.addColorStop(1, 'rgba(255, 255, 255, 0)');
            ctx.fillStyle = highlightGradient;
            ctx.beginPath();
            ctx.roundRect(startX + 2, startY + 2, paddle.width - 4, paddle.height / 2, 6);
            ctx.fill();
        }

        // Y2K-themed metallic chrome paddle
        function drawY2KPaddle() {
            const startX = paddle.x;
            const startY = paddle.y;

            // Metallic chrome gradient
            const gradient = ctx.createLinearGradient(startX, startY, startX, startY + paddle.height);
            gradient.addColorStop(0, '#E0E0E0');
            gradient.addColorStop(0.3, '#FFFFFF');
            gradient.addColorStop(0.5, '#C0C0C0');
            gradient.addColorStop(0.7, '#808080');
            gradient.addColorStop(1, '#A0A0A0');

            ctx.fillStyle = gradient;
            ctx.shadowBlur = 15;
            ctx.shadowColor = 'rgba(0, 255, 255, 0.6)';

            // Angular shape
            ctx.beginPath();
            ctx.moveTo(startX + 4, startY);
            ctx.lineTo(startX + paddle.width - 4, startY);
            ctx.lineTo(startX + paddle.width, startY + 4);
            ctx.lineTo(startX + paddle.width, startY + paddle.height - 4);
            ctx.lineTo(startX + paddle.width - 4, startY + paddle.height);
            ctx.lineTo(startX + 4, startY + paddle.height);
            ctx.lineTo(startX, startY + paddle.height - 4);
            ctx.lineTo(startX, startY + 4);
            ctx.closePath();
            ctx.fill();

            // Neon outline
            ctx.strokeStyle = backgroundAnimFrame % 60 < 30 ? '#FF1493' : '#00FFFF';
            ctx.lineWidth = 2;
            ctx.stroke();
            ctx.shadowBlur = 0;
        }

        function drawToyStickPaddle() {
            // Pixel art feather wand
            const pixelSize = 2;
            const startX = Math.floor(paddle.x);
            const startY = Math.floor(paddle.y);

            // Stick pattern (brown wooden stick)
            const stickPattern = [
                [0,0,0,1,1,1,0,0,0],
                [0,0,0,1,2,1,0,0,0],
                [0,0,0,1,1,1,0,0,0],
                [0,0,0,1,2,1,0,0,0],
                [0,0,0,1,1,1,0,0,0]
            ];

            // Draw stick in center
            const stickX = startX + paddle.width / 2 - 9;
            stickPattern.forEach((row, y) => {
                row.forEach((pixel, x) => {
                    if (pixel > 0) {
                        ctx.fillStyle = pixel === 1 ? '#8B4513' : '#A0522D';
                        ctx.fillRect(stickX + x * pixelSize, startY + y * pixelSize, pixelSize, pixelSize);
                    }
                });
            });

            // Feathers (colorful pixel feathers along the paddle)
            const featherColors = ['#FF1493', '#FFD700', '#00CED1', '#FF69B4', '#9370DB'];
            for (let i = 0; i < paddle.width; i += 8) {
                const color = featherColors[Math.floor(i / 8) % featherColors.length];
                // Small feather pixels
                ctx.fillStyle = color;
                ctx.fillRect(startX + i, startY + 2, 3, 2);
                ctx.fillRect(startX + i + 1, startY, 2, 2);
                ctx.fillRect(startX + i + 2, startY + 4, 2, 2);
            }
        }

        function drawCushionPaddle() {
            // Pixel art cushion/pillow
            const pixelSize = 2;
            const startX = Math.floor(paddle.x);
            const startY = Math.floor(paddle.y);

            // Cushion pattern with quilted effect
            const cushionHeight = Math.floor(paddle.height / pixelSize);
            const cushionWidth = Math.floor(paddle.width / pixelSize);

            // Draw base cushion
            for (let y = 0; y < cushionHeight; y++) {
                for (let x = 0; x < cushionWidth; x++) {
                    // Create quilted pattern
                    const isEdge = y === 0 || y === cushionHeight - 1 || x === 0 || x === cushionWidth - 1;
                    const isQuiltLine = (x % 8 === 0 || y % 3 === 0);

                    let color = '#FFC0CB'; // Light pink
                    if (isEdge) color = '#FFB6C1'; // Darker pink edge
                    else if (isQuiltLine) color = '#FF69B4'; // Quilt lines

                    ctx.fillStyle = color;
                    ctx.fillRect(startX + x * pixelSize, startY + y * pixelSize, pixelSize, pixelSize);
                }
            }

            // Add decorative tassels
            const tasselPositions = [10, paddle.width / 2, paddle.width - 10];
            tasselPositions.forEach(pos => {
                ctx.fillStyle = '#FF1493';
                ctx.fillRect(startX + pos, startY + paddle.height - 2, 3, 2);
            });
        }

        function drawMousePaddle() {
            // Pixel art squeaky mouse toy
            const pixelSize = 2;
            const startX = Math.floor(paddle.x);
            const startY = Math.floor(paddle.y);

            // Mouse body pattern (gray mouse)
            const mousePattern = [
                [0,0,1,1,1,1,1,0,0],
                [0,1,2,2,2,2,2,1,0],
                [1,2,2,3,2,3,2,2,1],
                [1,2,2,2,4,2,2,2,1],
                [0,1,2,2,2,2,2,1,0],
                [0,0,1,1,1,1,1,0,0]
            ];

            // Draw mice along the paddle
            const numMice = Math.floor(paddle.width / 25);
            for (let m = 0; m < numMice; m++) {
                const mouseX = startX + m * 25 + 5;
                mousePattern.forEach((row, y) => {
                    row.forEach((pixel, x) => {
                        if (pixel > 0) {
                            const colors = {
                                1: '#696969', // Dark outline
                                2: '#A9A9A9', // Gray body
                                3: '#000000', // Eyes
                                4: '#FFC0CB'  // Pink nose
                            };
                            ctx.fillStyle = colors[pixel];
                            ctx.fillRect(mouseX + x * pixelSize, startY + y * pixelSize, pixelSize, pixelSize);
                        }
                    });
                });

                // Tail
                ctx.fillStyle = '#696969';
                ctx.fillRect(mouseX + 18, startY + 8, 6, 2);
            }
        }

        function drawLaserPaddle() {
            // Pixel art laser pointer device
            const pixelSize = 2;
            const startX = Math.floor(paddle.x);
            const startY = Math.floor(paddle.y);

            // Laser pointer body pattern
            const pointerPattern = [
                [0,1,1,1,1,1,0],
                [1,2,2,2,2,2,1],
                [1,2,3,3,3,2,1],
                [1,2,2,2,2,2,1],
                [0,1,1,1,1,1,0]
            ];

            // Draw pointer devices along paddle
            const numPointers = Math.floor(paddle.width / 20);
            for (let p = 0; p < numPointers; p++) {
                const pointerX = startX + p * 20 + 3;

                pointerPattern.forEach((row, y) => {
                    row.forEach((pixel, x) => {
                        if (pixel > 0) {
                            const colors = {
                                1: '#808080', // Dark gray outline
                                2: '#C0C0C0', // Silver body
                                3: '#606060'  // Button area
                            };
                            ctx.fillStyle = colors[pixel];
                            ctx.fillRect(pointerX + x * pixelSize, startY + y * pixelSize, pixelSize, pixelSize);
                        }
                    });
                });

                // Glowing red laser dot at end
                const dotX = pointerX + 14;
                const dotY = startY + 5;

                // Glow effect
                ctx.fillStyle = 'rgba(255, 0, 0, 0.3)';
                ctx.fillRect(dotX - 2, dotY - 2, 8, 8);

                // Core dot
                ctx.fillStyle = '#FF0000';
                ctx.fillRect(dotX, dotY, 4, 4);

                ctx.fillStyle = '#FF6666';
                ctx.fillRect(dotX + 1, dotY + 1, 2, 2);
            }
        }

        function drawKitties() {
            kitties.forEach(kitty => {
                ctx.save();
                ctx.translate(kitty.x, kitty.y);
                ctx.rotate(kitty.rotation);

                // Apply squash effect
                ctx.scale(1 / kitty.squashFactor, kitty.squashFactor);

                ctx.translate(-kitty.x, -kitty.y);

                // Draw based on theme
                if (currentTheme === 'aero') {
                    drawAeroKitty(kitty.x, kitty.y, kitty.radius * 2, kitty.type);
                } else if (currentTheme === 'y2k') {
                    drawY2KKitty(kitty.x, kitty.y, kitty.radius * 2, kitty.type);
                } else {
                    drawPixelKitty(ctx, kitty.x, kitty.y, kitty.radius * 2, kitty.type);
                }

                // Draw emotion if active
                if (kitty.showEmotion) {
                    ctx.resetTransform();
                    const emotionY = kitty.y - kitty.radius - 10;

                    // Surprised eyes (pixel art)
                    ctx.fillStyle = '#000000';
                    ctx.fillRect(kitty.x - 8, emotionY, 4, 4);
                    ctx.fillRect(kitty.x + 4, emotionY, 4, 4);

                    // Happy mouth
                    ctx.fillRect(kitty.x - 6, emotionY + 6, 2, 2);
                    ctx.fillRect(kitty.x - 4, emotionY + 8, 2, 2);
                    ctx.fillRect(kitty.x - 2, emotionY + 9, 2, 2);
                    ctx.fillRect(kitty.x, emotionY + 10, 2, 2);
                    ctx.fillRect(kitty.x + 2, emotionY + 9, 2, 2);
                    ctx.fillRect(kitty.x + 4, emotionY + 8, 2, 2);
                }

                ctx.restore();
            });
        }

        function drawCollectibles() {
            ctx.font = '20px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';

            collectibles.forEach(c => {
                ctx.fillText(c.type.icon, c.x, c.y);
            });
        }

        // Background animation state
        let cloudOffset = 0;
        let animalAnimFrame = 0;
        let backgroundAnimFrame = 0;

        function drawBackground() {
            backgroundAnimFrame++;

            // Dispatch to theme-specific background
            if (currentTheme === 'aero') {
                drawAeroBackground();
            } else if (currentTheme === 'y2k') {
                drawY2KBackground();
            } else {
                drawRetroBackground();
            }
        }

        function drawRetroBackground() {
            // Sky gradient
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, '#B5E3FF');
            gradient.addColorStop(0.5, '#D4EFFF');
            gradient.addColorStop(1, '#E8F4FF');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Animated clouds
            cloudOffset += 0.2;
            if (cloudOffset > canvas.width) cloudOffset = -100;
            drawPixelCloud(cloudOffset, 50);
            drawPixelCloud(cloudOffset + 300, 120);
            drawPixelCloud(cloudOffset + 500, 80);
            drawPixelCloud(cloudOffset - 200, 150);

            // Grass ground
            ctx.fillStyle = '#90EE90';
            ctx.fillRect(0, canvas.height - 80, canvas.width, 80);

            // Grass texture (pixel dots)
            ctx.fillStyle = '#7CCD7C';
            for (let x = 0; x < canvas.width; x += 8) {
                for (let y = canvas.height - 80; y < canvas.height; y += 6) {
                    if (Math.random() > 0.7) {
                        ctx.fillRect(x, y, 2, 2);
                    }
                }
            }

            ctx.globalAlpha = 0.8;

            // Enhanced pixel art trees
            drawPixelTree(100, canvas.height - 80);
            drawPixelTree(300, canvas.height - 80);
            drawPixelTree(500, canvas.height - 80);
            drawPixelTree(700, canvas.height - 80);

            // Pixel art bushes
            drawPixelBush(150, canvas.height - 50);
            drawPixelBush(450, canvas.height - 50);
            drawPixelBush(650, canvas.height - 50);

            // Pixel art flowers
            drawPixelFlower(200, canvas.height - 45, '#FF69B4');
            drawPixelFlower(380, canvas.height - 40, '#FFD700');
            drawPixelFlower(550, canvas.height - 42, '#FF6B6B');
            drawPixelFlower(120, canvas.height - 48, '#9370DB');
            drawPixelFlower(620, canvas.height - 44, '#00CED1');

            // Animated forest animals (pixel art)
            animalAnimFrame++;
            drawPixelSquirrel(50, canvas.height - 60, animalAnimFrame);
            drawPixelHedgehog(600, canvas.height - 55, animalAnimFrame);
            drawPixelBird(250, canvas.height - 120, animalAnimFrame);

            ctx.globalAlpha = 1.0;
        }

        function drawPixelCloud(x, y) {
            const pixelSize = 3;
            const cloudPattern = [
                [0,0,1,1,1,1,0,0],
                [0,1,2,2,2,2,1,0],
                [1,2,2,2,2,2,2,1],
                [1,2,2,2,2,2,2,1],
                [0,1,1,1,1,1,1,0]
            ];

            cloudPattern.forEach((row, py) => {
                row.forEach((pixel, px) => {
                    if (pixel > 0) {
                        ctx.fillStyle = pixel === 1 ? '#E0E0E0' : '#FFFFFF';
                        ctx.fillRect(x + px * pixelSize, y + py * pixelSize, pixelSize, pixelSize);
                    }
                });
            });
        }

        function drawPixelTree(x, y) {
            const pixelSize = 2;
            // Trunk
            ctx.fillStyle = '#8B4513';
            ctx.fillRect(x - 6, y - 40, 12, 40);
            ctx.fillStyle = '#A0522D';
            ctx.fillRect(x - 4, y - 40, 4, 40);

            // Leaves (layered triangles)
            const leafPattern = [
                [0,0,0,1,1,0,0,0],
                [0,0,1,2,2,1,0,0],
                [0,1,2,2,2,2,1,0],
                [1,2,2,2,2,2,2,1]
            ];

            // Draw 3 layers
            for (let layer = 0; layer < 3; layer++) {
                const offsetY = y - 60 + layer * 10;
                leafPattern.forEach((row, py) => {
                    row.forEach((pixel, px) => {
                        if (pixel > 0) {
                            ctx.fillStyle = pixel === 1 ? '#228B22' : '#32CD32';
                            ctx.fillRect(x - 16 + px * pixelSize, offsetY + py * pixelSize, pixelSize, pixelSize);
                        }
                    });
                });
            }
        }

        function drawPixelBush(x, y) {
            const pixelSize = 2;
            const bushPattern = [
                [0,1,1,1,1,0],
                [1,2,2,2,2,1],
                [1,2,3,3,2,1],
                [0,1,2,2,1,0]
            ];

            bushPattern.forEach((row, py) => {
                row.forEach((pixel, px) => {
                    if (pixel > 0) {
                        const colors = {1: '#228B22', 2: '#32CD32', 3: '#FF6B6B'}; // Berries
                        ctx.fillStyle = colors[pixel];
                        ctx.fillRect(x - 6 + px * pixelSize, y + py * pixelSize, pixelSize, pixelSize);
                    }
                });
            });
        }

        function drawPixelFlower(x, y, color) {
            const pixelSize = 2;
            // Petals
            ctx.fillStyle = color;
            ctx.fillRect(x - 2, y, pixelSize, pixelSize); // Left
            ctx.fillRect(x + 2, y, pixelSize, pixelSize); // Right
            ctx.fillRect(x, y - 2, pixelSize, pixelSize); // Top
            ctx.fillRect(x, y + 2, pixelSize, pixelSize); // Bottom

            // Center
            ctx.fillStyle = '#FFD700';
            ctx.fillRect(x, y, pixelSize, pixelSize);

            // Stem
            ctx.fillStyle = '#228B22';
            ctx.fillRect(x, y + 4, pixelSize, 6);
        }

        function drawPixelSquirrel(x, y, frame) {
            const pixelSize = 2;
            const tailWag = Math.sin(frame * 0.1) > 0 ? 0 : 1;

            const squirrelPattern = [
                [0,0,1,1],
                [0,1,2,1],
                [1,2,3,1],
                [0,1,1,0]
            ];

            squirrelPattern.forEach((row, py) => {
                row.forEach((pixel, px) => {
                    if (pixel > 0) {
                        const colors = {1: '#8B4513', 2: '#D2691E', 3: '#000'};
                        ctx.fillStyle = colors[pixel];
                        ctx.fillRect(x + px * pixelSize, y + py * pixelSize, pixelSize, pixelSize);
                    }
                });
            });

            // Animated tail
            ctx.fillStyle = '#8B4513';
            ctx.fillRect(x - 4, y + tailWag * 2, 3, 6);
        }

        function drawPixelHedgehog(x, y, frame) {
            const pixelSize = 2;
            const hedgehogPattern = [
                [0,1,1,1,0],
                [1,2,3,2,1],
                [0,1,2,2,0]
            ];

            hedgehogPattern.forEach((row, py) => {
                row.forEach((pixel, px) => {
                    if (pixel > 0) {
                        const colors = {1: '#8B4513', 2: '#D2B48C', 3: '#000'};
                        ctx.fillStyle = colors[pixel];
                        ctx.fillRect(x + px * pixelSize, y + py * pixelSize, pixelSize, pixelSize);
                    }
                });
            });
        }

        function drawPixelBird(x, y, frame) {
            const pixelSize = 2;
            const wingFlap = Math.sin(frame * 0.15) > 0;

            // Body
            ctx.fillStyle = '#4169E1';
            ctx.fillRect(x, y, 4, 4);
            ctx.fillStyle = '#FFD700';
            ctx.fillRect(x + 4, y + 2, 2, 2); // Beak

            // Wings
            if (wingFlap) {
                ctx.fillStyle = '#4169E1';
                ctx.fillRect(x - 2, y, 2, 2);
                ctx.fillRect(x + 4, y, 2, 2);
            } else {
                ctx.fillRect(x - 1, y + 2, 2, 2);
                ctx.fillRect(x + 3, y + 2, 2, 2);
            }
        }

        // Frutiger Aero Background (Vista/7 style)
        function drawAeroBackground() {
            // Soft gradient sky
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, '#87CEEB');
            gradient.addColorStop(0.6, '#B0E0E6');
            gradient.addColorStop(1, '#E0F6FF');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Soft clouds (smooth, not pixel art)
            cloudOffset += 0.3;
            if (cloudOffset > canvas.width) cloudOffset = -150;

            ctx.globalAlpha = 0.7;
            drawSmoothCloud(cloudOffset, 60, 100, 40);
            drawSmoothCloud(cloudOffset + 250, 120, 120, 50);
            drawSmoothCloud(cloudOffset + 500, 80, 90, 35);
            ctx.globalAlpha = 1.0;

            // Grass with gradient
            const grassGradient = ctx.createLinearGradient(0, canvas.height - 100, 0, canvas.height);
            grassGradient.addColorStop(0, '#90EE90');
            grassGradient.addColorStop(1, '#7FBA00');
            ctx.fillStyle = grassGradient;
            ctx.fillRect(0, canvas.height - 100, canvas.width, 100);

            // Smooth flowers
            ctx.globalAlpha = 0.8;
            for (let i = 0; i < 10; i++) {
                const x = 50 + i * 75;
                const y = canvas.height - 50 - Math.random() * 20;
                drawSmoothFlower(x, y, ['#FF69B4', '#FFD700', '#9370DB', '#00CED1'][i % 4]);
            }
            ctx.globalAlpha = 1.0;
        }

        function drawSmoothCloud(x, y, width, height) {
            ctx.fillStyle = '#FFFFFF';
            ctx.beginPath();
            ctx.ellipse(x, y, width/2, height/2, 0, 0, Math.PI * 2);
            ctx.fill();
            ctx.beginPath();
            ctx.ellipse(x + width/3, y - height/3, width/3, height/3, 0, 0, Math.PI * 2);
            ctx.fill();
            ctx.beginPath();
            ctx.ellipse(x - width/3, y, width/2.5, height/2.5, 0, 0, Math.PI * 2);
            ctx.fill();
        }

        function drawSmoothFlower(x, y, color) {
            // Petals
            ctx.fillStyle = color;
            for (let i = 0; i < 6; i++) {
                const angle = (Math.PI * 2 * i) / 6;
                ctx.beginPath();
                ctx.ellipse(x + Math.cos(angle) * 8, y + Math.sin(angle) * 8, 6, 4, angle, 0, Math.PI * 2);
                ctx.fill();
            }

            // Center
            ctx.fillStyle = '#FFD700';
            ctx.beginPath();
            ctx.arc(x, y, 4, 0, Math.PI * 2);
            ctx.fill();

            // Stem
            ctx.strokeStyle = '#7FBA00';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(x, y);
            ctx.lineTo(x, y + 20);
            ctx.stroke();
        }

        // Y2K Edgy Background (Cyber/Matrix style)
        function drawY2KBackground() {
            // Dark cyber background
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, '#000000');
            gradient.addColorStop(0.5, '#0a0014');
            gradient.addColorStop(1, '#000000');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Grid floor
            ctx.strokeStyle = 'rgba(0, 255, 255, 0.2)';
            ctx.lineWidth = 1;
            for (let x = 0; x < canvas.width; x += 40) {
                ctx.beginPath();
                ctx.moveTo(x, canvas.height - 100);
                ctx.lineTo(canvas.width / 2 + (x - canvas.width / 2) * 1.5, canvas.height);
                ctx.stroke();
            }
            for (let y = canvas.height - 100; y < canvas.height; y += 20) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();
            }

            // Matrix code rain effect
            ctx.font = '12px monospace';
            ctx.fillStyle = 'rgba(0, 255, 0, 0.5)';
            for (let i = 0; i < 20; i++) {
                const x = (backgroundAnimFrame * 5 + i * 40) % canvas.width;
                for (let j = 0; j < 10; j++) {
                    const y = (backgroundAnimFrame + j * 30) % (canvas.height - 100);
                    const char = String.fromCharCode(0x30A0 + Math.floor(Math.random() * 96));
                    ctx.fillText(char, x, y);
                }
            }

            // Scan lines
            ctx.strokeStyle = 'rgba(0, 255, 255, 0.05)';
            ctx.lineWidth = 2;
            for (let y = 0; y < canvas.height; y += 4) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();
            }

            // Neon city silhouette
            ctx.fillStyle = '#000000';
            for (let i = 0; i < 10; i++) {
                const buildingX = i * 80;
                const buildingHeight = 100 + Math.random() * 100;
                ctx.fillRect(buildingX, canvas.height - buildingHeight, 70, buildingHeight);

                // Neon windows
                ctx.fillStyle = Math.random() > 0.5 ? '#FF1493' : '#00FFFF';
                for (let w = 0; w < 5; w++) {
                    for (let h = 0; h < buildingHeight / 20; h++) {
                        if (Math.random() > 0.5) {
                            ctx.fillRect(buildingX + 10 + w * 10, canvas.height - buildingHeight + h * 15, 6, 10);
                        }
                    }
                }
                ctx.fillStyle = '#000000';
            }
        }

        function updateScore() {
            document.getElementById('score').textContent = score;
            if (score > highScore) {
                highScore = score;
                localStorage.setItem('kittyBounce98HighScore', highScore);
                document.getElementById('highScore').textContent = highScore;
            }

            // Level up every 200 points
            const newLevel = Math.floor(score / 200) + 1;
            if (newLevel > level) {
                level = newLevel;
                updateLevel();
                playLevelUpSound();
                updateStatus(`Level Up! Now at Level ${level}`);
            }
        }

        function updateLives() {
            document.getElementById('lives').textContent = lives;
        }

        function updateLevel() {
            document.getElementById('level').textContent = level;
        }

        function updateStatus(message) {
            document.getElementById('statusMessage').textContent = message;
        }

        function gameOver() {
            gameRunning = false;
            stopBackgroundMusic();
            playGameOverSound();

            const previousHighScore = parseInt(localStorage.getItem('kittyBounce98HighScore') || 0);
            const isNewHighScore = score > previousHighScore;

            document.getElementById('finalScore').textContent = score;
            document.getElementById('finalLevel').textContent = level;
            document.getElementById('gameOverScreen').style.display = 'flex';
            updateStatus('Game Over');

            if (isNewHighScore) {
                document.getElementById('highScoreMessage').style.display = 'block';
                triggerKittyConfetti();
            } else {
                document.getElementById('highScoreMessage').style.display = 'none';
            }
        }

        function triggerKittyConfetti() {
            const confettiParticles = [];
            const confettiCount = 50;

            for (let i = 0; i < confettiCount; i++) {
                confettiParticles.push({
                    x: canvas.width / 2,
                    y: canvas.height / 2,
                    vx: (Math.random() - 0.5) * 10,
                    vy: (Math.random() - 0.5) * 10 - 5,
                    rotation: Math.random() * Math.PI * 2,
                    rotationSpeed: (Math.random() - 0.5) * 0.2,
                    kittyType: kittyTypes[Math.floor(Math.random() * kittyTypes.length)],
                    size: 15 + Math.random() * 15,
                    life: 0
                });
            }

            function animateConfetti() {
                const overlay = document.getElementById('gameOverScreen');
                if (overlay.style.display !== 'flex') return;

                ctx.clearRect(0, 0, canvas.width, canvas.height);
                drawBackground();

                confettiParticles.forEach((p) => {
                    p.x += p.vx;
                    p.y += p.vy;
                    p.vy += 0.3;
                    p.rotation += p.rotationSpeed;
                    p.life++;

                    if (p.life < 180) {
                        ctx.save();
                        ctx.globalAlpha = 1 - (p.life / 180);
                        ctx.translate(p.x, p.y);
                        ctx.rotate(p.rotation);
                        ctx.translate(-p.x, -p.y);
                        drawPixelKitty(ctx, p.x, p.y, p.size, p.kittyType);
                        ctx.restore();
                    }
                });

                if (confettiParticles.some(p => p.life < 180)) {
                    requestAnimationFrame(animateConfetti);
                }
            }

            animateConfetti();
        }

        function gameLoop() {
            if (!gameRunning || gamePaused) {
                if (!gameRunning && animationId) {
                    cancelAnimationFrame(animationId);
                    animationId = null;
                }
                return;
            }

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            drawBackground();
            updatePaddle();
            updateKitties();
            updateCollectibles();
            updateParticles();

            drawCollectibles();
            drawKitties();
            drawPaddle();
            drawParticles();

            animationId = requestAnimationFrame(gameLoop);
        }
    </script>
</body>
</html>
